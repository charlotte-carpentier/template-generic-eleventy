{# ┌─────────────────────────────────────────────────────────┐
   │ ORGANISM › Modal                                        │
   │ Native HTML5 dialog with backdrop and action buttons    │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Modal identifier
    - options.datas (array): Modal configuration data
    - options.headingDatas (array): Heading atom data
    - options.buttonDatas (array): Button atom data
    - options.iconDatas (array): Icon atom data (optional, required if buttons have icons)
    - options.tooltipDatas (array): Tooltip atom data (optional, required if buttons have tooltips)

  Usage — Summon HAT Components Wisely:
    {% from "03-organisms/modal.njk" import renderModal %}

    {{ renderModal({
        name: "demoModal1",
        datas: organisms.modal.modals,
        headingDatas: atoms.heading.headings,
        buttonDatas: atoms.button.buttons
    }) }}

  @created 2025-01-15
  @updated 2025-12-12 (HTML5 dialog native)
#}

{% macro renderModal(options) %}
  {# Import sub-components #}
  {% from "01-atoms/heading.njk" import renderHeading %}
  {% from "01-atoms/button.njk" import renderButton %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find modal using universal filter #}
    {% set modalData = options.datas | findByName(options.name) %}

    {# Render modal or error message #}
    {% if not modalData %}
      <span class="error" role="alert">Modal not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set modalName = modalData.name | default(options.name) %}
      {% set headingName = modalData.headingName | default('') %}
      {% set content = modalData.content | default('') %}
      {% set primaryButton = modalData.primaryButton | default('') %}
      {% set secondaryButton = modalData.secondaryButton | default('') %}
      {% set ariaLabel = modalData.ariaLabel | default('Modal dialog') %}
      {% set ariaDescribedBy = modalData.ariaDescribedBy | default('') %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Dialog Classes
        3.2 Wrapper Classes
        3.3 Header Classes
        3.4 Content Classes
        3.5 Footer Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Dialog Classes
          Description: Layout, Background, Shadow, Borders, Sizing, Positioning, Backdrop
        --------------------------#}
      {% set dialogClasses = "fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 m-0 max-w-[90vw] p-0 border-none bg-[var(--color-global-white)] rounded-[var(--radius-modal)] shadow-[var(--elevation-floating)] backdrop:bg-black/50 md:max-w-md lg:max-w-lg" %}

      {# --------------------------
          3.2 Wrapper Classes
          Description: Layout, Spacing
        --------------------------#}
      {% set containerClasses = "flex flex-col p-[var(--spacing-inset-large)]" %}

      {# --------------------------
          3.3 Header Classes
          Description: Layout, Spacing bottom
        --------------------------#}
      {% set headerClasses = "flex mb-[var(--spacing-stack-medium)]" %}

      {# --------------------------
          3.4 Content Classes
          Description: Typography, Colors, Spacing bottom
        --------------------------#}
      {% set contentClasses = "font-body text-body text-[var(--color-global-default)] mb-[var(--spacing-stack-large)]" %}

      {# --------------------------
          3.5 Footer Classes
          Description: Layout horizontal, Spacing
        --------------------------#}
      {% set footerClasses = "flex gap-[var(--spacing-inline-medium)]" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# Native HTML5 dialog element #}
      <dialog
        class="{{ dialogClasses }}"
        id="{{ modalName }}"
        aria-label="{{ ariaLabel }}"
        {% if ariaDescribedBy %}aria-describedby="{{ ariaDescribedBy }}"{% endif %}
        data-modal-name="{{ modalName }}"
        data-modal-type="modal"
      >

        <div
          class="{{ containerClasses }}"
          data-modal-container
        >

          {# Modal header with heading #}
          {% if headingName %}
            <div
              class="{{ headerClasses }}"
              data-modal-header
            >
              {{ renderHeading({
                  name: headingName,
                  datas: options.headingDatas
              }) }}
            </div>
          {% endif %}

          {# Modal content #}
          {% if content %}
            <div
              class="{{ contentClasses }}"
              data-modal-content
              {% if ariaDescribedBy %}id="{{ ariaDescribedBy }}"{% endif %}
            >
              <p>{{ content }}</p>
            </div>
          {% endif %}

          {# Modal footer with action buttons #}
          {% if primaryButton or secondaryButton %}
            <div
              class="{{ footerClasses }}"
              data-modal-footer
            >

              {# Primary action button #}
              {% if primaryButton %}
                {{ renderButton({
                    name: primaryButton,
                    datas: options.buttonDatas,
                    iconDatas: options.iconDatas,
                    tooltipDatas: options.tooltipDatas
                }) }}
              {% endif %}

              {# Secondary action button #}
              {% if secondaryButton %}
                {{ renderButton({
                    name: secondaryButton,
                    datas: options.buttonDatas,
                    iconDatas: options.iconDatas,
                    tooltipDatas: options.tooltipDatas
                }) }}
              {% endif %}

            </div>
          {% endif %}

        </div>

      </dialog>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
