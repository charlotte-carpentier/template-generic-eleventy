{# ┌─────────────────────────────────────────────────────────┐
   │ ORGANISM › Menu                                         │
   │ Navigation menu with heading and secondary nav          │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    {% from "03-organisms/menu.njk" import renderMenu %}
    {{ renderMenu({ 
        name: "main_navigation",
        datas: organisms.menus,
        "navigation-secondarys": organisms["navigation-secondarys"],
        links: atoms.links,
        headings: atoms.headings
    }) }}
    
    With custom styles:
    {{ renderMenu({ 
        name: "footer_navigation",
        datas: organisms.menus,
        "navigation-secondarys": organisms["navigation-secondarys"],
        links: atoms.links,
        headings: atoms.headings,
        class: "my-custom-menu-class"
    }) }}
  
  Props:
    - options.name (string): Menu identifier
    - options.datas (object): Menu configuration
    - options.navigation-secondarys (object): Secondary navigation data
    - options.links (object): Links atom data
    - options.headings (object): Headings atom data
    - options.class (string): Additional CSS classes
  
  Features:
    - Dynamic heading with level and styling
    - Integration with navigation-secondary organism
    - Heading text resolution from data
    - Falls back to first menu if name not found
  
  @created 2025-01-15
#}

{% from "01-organisms/navigation-secondary.njk" import renderNavigationSecondary %}

{% macro renderMenu(options) %}
  {% if options.datas %}
    {% set globalStyle = options.datas.globalStyle %}
    
    {% set menuData = null %}
    {% if options.name %}
      {% for menuSet in options.datas.menus %}
        {% if menuSet.name == options.name %}
          {% set menuData = menuSet %}
        {% endif %}
      {% endfor %}
    {% endif %}

    {% if not menuData %}
      {% set menuData = options.datas.menus[0] %}
    {% endif %}
    
    {% set headingText = menuData.heading %}
    {% set headingLevel = 2 %}
    {% set headingStyle = menuData.headingStyle %}
    
    {% if options.headings %}
      {% for heading in options.headings.headings %}
        {% if heading.name == menuData.heading %}
          {% set headingText = heading.text %}
          {% set headingLevel = heading.level %}
          {% set headingStyle = headingStyle + ' ' + options.headings.variants[heading.style|default('default')] %}
        {% endif %}
      {% endfor %}
    {% endif %}
    
    <nav class="{{ globalStyle }} {{ options.class | default('') }}">
      <h{{ headingLevel }} class="{{ headingStyle }}">{{ headingText }}</h{{ headingLevel }}>
      
      {# Use navigation-secondary component #}
      {{ renderNavigationSecondary({ 
          name: menuData['navigation-secondarys'],
          datas: options['navigation-secondarys'],
          links: options.links,
          class: menuData.menuStyle
      }) }}
    </nav>
  {% else %}
    <span class="">Menu data not found</span>
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
Charlotte Carpentier · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}