{# ┌─────────────────────────────────────────────────────────┐
   │ ORGANISM › Section Contact                              │
   │ Contact section with form and nested section            │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    {% from "03-organisms/section-contact.njk" import renderSectionContact %}

    {{ renderSectionContact({
        name: "demoSectC1",
        datas: organisms["section-contact"].sectContacts,
        formDatas: molecules["list-form"].listForms,
        inputDatas: atoms.input.inputs,
        sectionA11yDatas: organisms["section-accessibility"].sectA11ys,
        headingDatas: atoms.heading.headings,
        buttonDatas: atoms.button.buttons
    }) }}

  @created 2025-09-15
  @updated 2026-02-03 (Security Phase: Netlify Forms + WCAG 2.2 AA)
#}

{% macro renderSectionContact(options) %}
  {# Import sub-components #}
  {% from "02-molecules/list-form.njk" import renderListForm %}
  {% from "03-organisms/section-accessibility.njk" import renderSectionAccessibility %}
  {% from "01-atoms/button.njk" import renderButton %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find section using universal filter #}
    {% set sectionData = options.datas | findByName(options.name) %}

    {# Render section or error message #}
    {% if not sectionData %}
      <span class="error" role="alert">Section not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set sectionName = sectionData.name | default(options.name) %}
      {% set leftForm = sectionData.leftForm | default('') %}
      {% set rightSection = sectionData.rightSection | default('') %}
      {% set buttonName = sectionData.buttonName | default('') %}
      {% set ariaLabel = sectionData.ariaLabel | default('Contact section') %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Wrapper Classes
        3.2 Layout Classes
        3.3 Left Column Classes
        3.4 Right Column Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Wrapper Classes
          Description: Layout, Spacing
        --------------------------#}
      {% set sectionClasses = "spacing-section-fluid-y" %}

      {# --------------------------
          3.2 Layout Classes
          Description: Layout responsive grid 2 columns, Spacing, Alignment top
      --------------------------#}
      {% set containerClasses = "w-full max-w-[var(--grid-workzone-mobile)] md:max-w-[var(--grid-workzone-desktop)] mx-auto" %}
      {% set gridClasses = "flex flex-col md:grid md:grid-cols-2 md:items-start gap-[var(--grid-gutter)]" %}

      {# --------------------------
          3.3 Left Column Classes
          Description: Layout vertical, Spacing
      --------------------------#}
      {% set leftColClasses = "flex flex-col gap-[var(--spacing-ui-default)]" %}

      {# --------------------------
          3.4 Right Column Classes
          Description: Layout, Override nested section padding for alignment with left column
      --------------------------#}
      {% set rightColClasses = "flex [&_section]:p-0 [&_section]:bg-transparent [&_section]:items-start [&_section>div]:mx-0 [&_section>div]:max-w-none [&_section>div]:w-full" %}

      {# --------------------------
          3.5 Form Wrapper Classes
          Description: Layout, Spacing
        --------------------------#}
      {% set formClasses = "flex flex-col gap-[var(--spacing-ui-default)]" %}

      {# --------------------------
          3.6 Honeypot Input Classes
          Description: Hidden field for spam protection
        --------------------------#}
      {% set honeypotClasses = "hidden" %}

      {# --------------------------
          3.7 Button Wrapper Classes
          Description: Alignment
        --------------------------#}
      {% set buttonWrapperClasses = "self-start" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <section
        class="{{ sectionClasses }}"
        aria-label="{{ ariaLabel }}"
        data-section-name="{{ sectionName }}"
        data-section-type="section-contact"
      >

        <div
        class="{{ containerClasses }}"
        data-section-container
        >

          <div
            class="{{ gridClasses }}"
            data-section-grid
          >

            {# Left column - Contact form #}
            <div
              class="{{ leftColClasses }}"
              data-section-column="left"
            >

              {% if leftForm %}
                {# Netlify Forms wrapper for security + accessibility #}
                <form
                  method="POST"
                  name="contact"
                  data-netlify="true"
                  data-netlify-honeypot="bot-field"
                  class="{{ formClasses }}"
                >
                  {# Netlify Forms required hidden inputs #}
                  <input type="hidden" name="form-name" value="contact" />
                  <input type="hidden" name="bot-field" class="{{ honeypotClasses }}" aria-hidden="true" />

                  {{ renderListForm({
                      name: leftForm,
                      datas: options.formDatas,
                      inputDatas: options.inputDatas
                  }) }}

                  <div class="{{ buttonWrapperClasses }}">
                    {{ renderButton({
                        name: buttonName,
                        datas: options.buttonDatas,
                        url: options.buttonUrl,
                        iconDatas: options.iconDatas,
                        tooltipDatas: options.tooltipDatas
                    }) }}
                  </div>
                </form>

              {% endif %}

            </div>

            {# Right column - Nested section-accessibility organism #}
            <div
              class="{{ rightColClasses }}"
              data-section-column="right"
            >

              {% if rightSection %}
                {{ renderSectionAccessibility({
                    name: rightSection,
                    datas: options.sectionA11yDatas,
                    headingDatas: options.headingDatas
                }) }}
              {% endif %}

            </div>

          </div>

        </div>

      </section>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
