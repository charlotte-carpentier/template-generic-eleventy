{# ┌─────────────────────────────────────────────────────────┐
   │ ORGANISM › Section Listing                              │
   │ Content listing section with cards and pagination       │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Section identifier
    - options.datas (array): Section configuration data
    - options.headingDatas (array): Heading atom data
    - options.cardDatas (array): Card molecule data
    - options.lockupDatas (array): Lockup molecule data (for cards)
    - options.imageDatas (array): Image atom data (for cards)
    - options.buttonDatas (array): Button atom data (for cards and pagination)
    - options.iconDatas (array): Icon atom data (for cards and pagination)
    - options.tooltipDatas (array): Tooltip atom data (optional, required if buttons/links have tooltips)
    - options.paginationDatas (array): Pagination molecule data
    - options.selectDatas (array): Select atom data (for pagination)
    - options.items (array): Paginated articles from Eleventy (NEW)

  Usage — Summon HAT Components Wisely:
    {% from "03-organisms/section-listing.njk" import renderSectionListing %}

    {{ renderSectionListing({
        name: "demoSectL1",
        datas: organisms["section-listing"].sectListings,
        headingDatas: atoms.heading.headings,
        cardDatas: molecules.card.cards,
        lockupDatas: molecules["lock-up"].lockUps,
        imageDatas: atoms.image.images,
        buttonDatas: atoms.button.buttons,
        iconDatas: atoms.icon.icons,
        paginationDatas: molecules.pagination.paginations,
        selectDatas: atoms.select.selects,
        items: paginatedArticles
    }) }}

  @created 2025-09-15
#}

{% macro renderSectionListing(options) %}
  {# Import sub-components #}
  {% from "01-atoms/heading.njk" import renderHeading %}
  {% from "02-molecules/card.njk" import renderCard %}
  {% from "02-molecules/pagination.njk" import renderPagination %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find section using universal filter #}
    {% set sectionData = options.datas | findByName(options.name) %}

    {# Render section or error message #}
    {% if not sectionData %}
      <span class="error" role="alert">Section not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set sectionName = sectionData.name | default(options.name) %}
      {% set headingName = sectionData.headingName | default('') %}
      {% set cardButtonName = sectionData.cardButtonName | default('readMore') %}
      {% set cardTags = sectionData.cardTags | default([]) %}
      {% set itemsPerPage = sectionData.itemsPerPage | default(8) %}
      {% set paginationName = sectionData.paginationName | default('') %}
      {% set ariaLabel = sectionData.ariaLabel | default('Listing section') %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Wrapper Classes
        3.2 Layout Classes
        3.3 Heading Wrapper Classes
        3.4 Cards Grid Classes
        3.5 Pagination Wrapper Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Wrapper Classes
          Description: Layout, Spacing, Background
        --------------------------#}
      {% set sectionClasses = "spacing-section-fluid-y" %}

      {# --------------------------
          3.2 Layout Classes
          Description: Layout vertical, Spacing between sections
        --------------------------#}
      {% set containerClasses = "w-full max-w-[var(--grid-workzone-mobile)] md:max-w-[var(--grid-workzone-desktop)] mx-auto" %}
      {% set gridClasses = "flex flex-col gap-[var(--spacing-ui-maximal)]" %}

      {# --------------------------
          3.3 Heading Wrapper Classes
          Description: Layout
        --------------------------#}
      {% set headingClasses = "flex" %}

      {# --------------------------
          3.4 Cards Grid Classes
          Description: Layout responsive grid with breakpoints, Spacing, Override card width
      --------------------------#}
      {% set cardsGridClasses = "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-[var(--grid-gutter)] [&>*]:max-w-[var(--grid-col-4)] [&>*]:mx-auto" %}

      {# --------------------------
          3.5 Pagination Wrapper Classes
          Description: Layout, Alignment centered
        --------------------------#}
      {% set paginationClasses = "flex justify-center" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <section
        class="{{ sectionClasses }}"
        aria-label="{{ ariaLabel }}"
        data-section-name="{{ sectionName }}"
        data-section-type="section-listing"
      >

        <div
          class="{{ containerClasses }}"
          data-section-container
        >

          <div
            class="{{ gridClasses }}"
            data-section-grid
          >

            {# Section heading #}
            {% if headingName %}
              <div
                class="{{ headingClasses }}"
                data-section-heading
              >
                {{ renderHeading({
                    name: headingName,
                    datas: options.headingDatas
                }) }}
              </div>
            {% endif %}

            {# Cards grid - Loop on paginated items (articles) #}
            <div
              class="{{ cardsGridClasses }}"
              data-section-cards
              data-items-per-page="{{ itemsPerPage }}"
            >
              {% if options.items %}
                {% for article in options.items %}
                  {{ renderCard({
                      name: "articleCard",
                      datas: [{
                        name: "articleCard",
                        headingName: article.data.title,
                        content: article.data.description or (article.templateContent | striptags | truncate(150)),
                        buttonName: cardButtonName,
                        tags: article.data.tags
                      }],
                      headingDatas: [{
                        name: article.data.title,
                        text: article.data.title,
                        level: 3
                      }],
                      buttonDatas: options.buttonDatas,
                      buttonUrl: article.url,
                      iconDatas: options.iconDatas,
                      tooltipDatas: options.tooltipDatas
                  }) }}
                {% endfor %}
              {% elif cardTags and options.cardDatas %}
                {# Fallback: filter cards by tags for demo/non-paginated usage #}
                {% set filteredCards = options.cardDatas | filterCardsByTags(cardTags, itemsPerPage) %}
                {% for card in filteredCards %}
                  {{ renderCard({
                      name: card.name,
                      datas: options.cardDatas,
                      lockupDatas: options.lockupDatas,
                      imageDatas: options.imageDatas,
                      headingDatas: options.headingDatas,
                      buttonDatas: options.buttonDatas,
                      iconDatas: options.iconDatas,
                      tooltipDatas: options.tooltipDatas
                  }) }}
                {% endfor %}
              {% endif %}
            </div>

            {# Pagination - Optional #}
            {% if paginationName %}
              <div
                class="{{ paginationClasses }}"
                data-section-pagination
              >
              {{ renderPagination({
                  name: paginationName,
                  datas: options.paginationDatas,
                  pagination: options.pagination,
                  totalItems: options.totalItems,
                  selectDatas: options.selectDatas,
                  buttonDatas: options.buttonDatas,
                  iconDatas: options.iconDatas,
                  tooltipDatas: options.tooltipDatas
              }) }}
              </div>
            {% endif %}

          </div>

        </div>

      </section>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
