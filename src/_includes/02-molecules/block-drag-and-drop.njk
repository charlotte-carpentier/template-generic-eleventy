{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Block Drag and Drop                          │
   │ File upload with drag and drop support                  │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Block drag and drop identifier
    - options.datas (array): Block drag and drop configuration data
    - options.headingDatas (array): Heading atom data
    - options.iconDatas (array): Icon atom data
    - options.buttonDatas (array): Button atom data

  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/block-drag-and-drop.njk" import renderBlockDragAndDrop %}

    {{ renderBlockDragAndDrop({
        name: "demoDragDrop1",
        datas: molecules["block-drag-and-drop"].blockDragAndDrops,
        headingDatas: atoms.heading.headings,
        iconDatas: atoms.icon.icons,
        buttonDatas: atoms.button.buttons
    }) }}

  @created 2025-01-15
#}

{% from "01-atoms/heading.njk" import renderHeading %}
{% from "01-atoms/icon.njk" import renderIcon %}
{% from "01-atoms/button.njk" import renderButton %}

{% macro renderBlockDragAndDrop(options) %}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {% set blockData = options.datas | findByName(options.name) %}

    {% if not blockData %}
      <span class="error" role="alert">Block drag and drop not found: {{ options.name }}</span>
    {% else %}
      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         CSS Classes - Tailwind Utilities
      ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {% set containerClasses = "flex flex-col p-5 bg-white rounded-[var(--radius-card)] shadow-[var(--elevation-card)] w-full max-w-xl" %}
      {% set headingClasses = "mb-8 text-left font-serif text-[var(--color-global-default)]" %}
      {% set dropzoneClasses = "flex flex-col items-start justify-center p-8 border border-[var(--color-global-contrast-light-03)] rounded-[var(--radius-12)] bg-white min-h-[160px] cursor-pointer hover:bg-[var(--color-global-contrast-light-04)] transition-colors mb-4 focus:outline-none focus:ring-2 focus:ring-[var(--color-semantic-information-focus)] focus:ring-offset-2" %}
      {% set iconContainerClasses = "flex mb-3" %}
      {% set dropzoneTextClasses = "text-left text-base font-normal text-[var(--color-global-default)]" %}
      {% set orTextClasses = "block my-4 text-base font-normal text-[var(--color-global-default)]" %}
      {% set buttonContainerClasses = "flex mb-5" %}
      {% set fileInfoClasses = "flex flex-col gap-1 mt-2" %}
      {% set fileInfoLabelClasses = "text-sm text-[var(--color-global-contrast-light-02)]" %}
      {% set fileInfoValueClasses = "text-sm text-[var(--color-global-default)]" %}

      <div
        class="{{ containerClasses }}"
        data-drag-drop-name="{{ blockData.name }}"
        data-drag-drop-type="block-drag-and-drop"
        data-drag-drop="true"
        {% if blockData.supportedFormatsValue %}data-allowed-types="{{ blockData.supportedFormatsValue | lower | replace(' ', '') }}"{% endif %}
        {% if blockData.maxFileSizeValue %}data-max-size="{{ blockData.maxFileSizeValue | lower | replace(' ', '') }}"{% endif %}
      >
        <div class="{{ headingClasses }}">
          {{ renderHeading({
              name: blockData.headingName,
              datas: options.headingDatas
          }) }}
        </div>

        <div
          class="{{ dropzoneClasses }}"
          data-drag-drop-zone="true"
          tabindex="0"
          role="button"
          aria-label="Upload file by dropping it here or by clicking"
        >
          <div class="{{ iconContainerClasses }}">
            {{ renderIcon({
                name: blockData.iconName,
                datas: options.iconDatas,
                class: "w-14 h-14 text-[var(--color-global-contrast-light-02)]"
            }) }}
          </div>

          <p class="{{ dropzoneTextClasses }}" data-drag-drop-text="true">
            {{ blockData.dropzoneText }}
          </p>
        </div>

        <span class="{{ orTextClasses }}">{{ blockData.separator }}</span>

        <div class="{{ buttonContainerClasses }}" data-drag-drop-button="true">
          {{ renderButton({
              name: blockData.buttonName,
              datas: options.buttonDatas,
              disabled: blockData.variant == "loading"
          }) }}
        </div>

        <div class="{{ fileInfoClasses }}" data-drag-drop-info="true">
          <p>
            <span class="{{ fileInfoLabelClasses }}">{{ blockData.supportedFormatsLabel }} </span>
            <span class="{{ fileInfoValueClasses }}">{{ blockData.supportedFormatsValue }}</span>
          </p>
          <p>
            <span class="{{ fileInfoLabelClasses }}">{{ blockData.maxFileSizeLabel }} </span>
            <span class="{{ fileInfoValueClasses }}">{{ blockData.maxFileSizeValue }}</span>
          </p>
        </div>

        <input
          type="file"
          id="file-{{ blockData.name }}"
          class="sr-only"
          data-drag-drop-input="true"
          {% if blockData.supportedFormatsValue %}accept="{{ blockData.supportedFormatsValue | lower | replace(' ', '') }}"{% endif %}
          aria-hidden="true"
          tabindex="-1"
        >
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
