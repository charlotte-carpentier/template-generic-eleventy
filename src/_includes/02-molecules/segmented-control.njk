{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Segmented Control                            │
   │ Tab-style button group with active state                │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.id (string): Segmented control identifier
    - options.datas (array): Segmented control configuration data
    - options.buttonDatas (array): Button atom data (optional)

  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/segmented-control.njk" import renderSegmentedControl %}

    {{ renderSegmentedControl({
        id: "demoSeg1",
        datas: molecules["segmented-control"].segmentedControls,
        buttonDatas: atoms.button.buttons
    }) }}

  @created 2025-01-15
#}

{% from "01-atoms/button.njk" import renderButton %}

{% macro renderSegmentedControl(options) %}
  {# Validate required props #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.id %}
    <span class="error" role="alert">Error: Missing required prop (id)</span>
  {% else %}
    {# Find segmented control using universal filter (works with both name and id) #}
    {% set segmentedData = options.datas | findByName(options.id) %}

    {# Render or error #}
    {% if not segmentedData %}
      <span class="error" role="alert">Segmented control not found: {{ options.id }}</span>
    {% else %}
      <div
        data-segmented-id="{{ segmentedData.id }}"
        data-segmented-type="segmented-control"
        role="tablist"
        aria-label="Segmented control {{ segmentedData.id }}"
      >
        {# Items (boucle inévitable sur array items) #}
        {% for item in segmentedData.items %}
          <button
            type="button"
            role="tab"
            data-segmented-segment="true"
            data-segmented-variant="{{ item.variant }}"
            data-segmented-position="{% if loop.first %}first{% elif loop.last %}last{% else %}middle{% endif %}"
            {% if item.isActive %}data-segmented-active="true" aria-selected="true"{% else %}aria-selected="false"{% endif %}
          >
            {# Get button text from buttonDatas #}
            {% if item.buttonName and options.buttonDatas %}
              {% set buttonData = options.buttonDatas | findByName(item.buttonName) %}
              {% if buttonData %}
                {{ buttonData.text }}
              {% else %}
                Segment {{ loop.index }}
              {% endif %}
            {% else %}
              Segment {{ loop.index }}
            {% endif %}
          </button>
        {% endfor %}
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
