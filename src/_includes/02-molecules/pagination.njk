{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Pagination                                   │
   │ Native Eleventy pagination navigation                   │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Pagination identifier
    - options.datas (array): Pagination configuration data
    - options.pagination (object): Eleventy pagination object
    - options.totalItems (number): Total count of items
    - options.selectDatas (array): Select atom data (optional)
    - options.iconDatas (array): Icon atom data (required for nav icons)

  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/pagination.njk" import renderPagination %}

    {{ renderPagination({
        name: "blogPagination",
        datas: molecules.pagination.paginations,
        pagination: pagination,
        totalItems: collections.articles | length,
        selectDatas: atoms.select.selects,
        iconDatas: atoms.icon.icons
    }) }}

  @created 2025-01-15
#}

{% from "01-atoms/select.njk" import renderSelect %}
{% from "01-atoms/icon.njk" import renderIcon %}

{% macro renderPagination(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% elif not options.pagination %}
    <span class="error" role="alert">Error: Missing required prop (pagination)</span>
  {% else %}
    {# Find pagination using universal filter #}
    {% set paginationData = options.datas | findByName(options.name) %}

    {# Render pagination or error message #}
    {% if not paginationData %}
      <span class="error" role="alert">Pagination not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set paginationName = paginationData.name | default(options.name) %}
      {% set itemsPerPageData = paginationData.itemsPerPage | default({}) %}
      {% set selectName = itemsPerPageData.selectName | default('') %}
      {% set navigationData = paginationData.navigationPager | default({}) %}
      {% set siblingCount = navigationData.siblingCount | default(2) %}
      {% set icons = navigationData.icons | default({}) %}
      {% set totalCountData = paginationData.totalCount | default({}) %}
      {% set showCounter = totalCountData.show | default(false) %}

      {# Extract Eleventy pagination data #}
      {% set currentPageIndex = options.pagination.pageNumber %}
      {% set currentPageNumber = currentPageIndex + 1 %}
      {% set totalPages = options.pagination.hrefs | length %}
      {% set paginationHrefs = options.pagination.hrefs %}
      {% set paginationHref = options.pagination.href %}

      {# Calculate counter values #}
      {% set totalItems = options.totalItems | default(0) %}
      {% set itemsPerPage = options.pagination.size %}
      {% set firstItem = (currentPageIndex * itemsPerPage) + 1 %}
      {% set lastItem = (currentPageIndex + 1) * itemsPerPage %}
      {% if lastItem > totalItems %}
        {% set lastItem = totalItems %}
      {% endif %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Container Classes
        3.2 Select Wrapper Classes
        3.3 Nav Wrapper Classes
        3.4 Nav List Classes
        3.5 Nav Item Classes
        3.6 Nav Link Classes
        3.7 Counter Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Container Classes
          Description: Layout horizontal, Spacing, Alignment
        --------------------------#}
      {% set containerClasses = "flex items-center justify-between gap-[var(--spacing-inline-large)] w-full" %}

      {# --------------------------
          3.2 Select Wrapper Classes
          Description: Layout, Responsive
        --------------------------#}
      {% set selectWrapperClasses = "hidden md:flex flex-shrink-0" %}

      {# --------------------------
          3.3 Nav Wrapper Classes
          Description: Layout
        --------------------------#}
      {% set navWrapperClasses = "flex-1 flex justify-center" %}

      {# --------------------------
          3.4 Nav List Classes
          Description: Layout horizontal, Spacing
        --------------------------#}
      {% set navListClasses = "flex items-center gap-[var(--spacing-inline-tight)]" %}

      {# --------------------------
          3.5 Nav Item Classes
          Description: Layout
        --------------------------#}
      {% set navItemClasses = "" %}

      {# --------------------------
          3.6 Nav Link Classes
          Description: Layout, Typography, Colors, Borders, States
        --------------------------#}
      {% set navLinkBaseClasses = "inline-flex items-center justify-center min-w-[2rem] h-8 px-[var(--spacing-inline-medium)] typography-body-regular text-[var(--color-interactive-default)] bg-transparent border border-transparent rounded-[var(--radius-default)] transition-colors hover:bg-[var(--color-interactive-hover)] hover:text-[var(--color-global-white)] focus:outline-none focus:ring-2 focus:ring-[var(--color-semantic-information-focus)]" %}
      {% set navLinkActiveClasses = "bg-[var(--color-interactive-default)] text-[var(--color-global-white)]" %}
      {% set navLinkDisabledClasses = "opacity-50 cursor-not-allowed pointer-events-none" %}

      {# --------------------------
          3.7 Counter Classes
          Description: Typography, Colors, Responsive
        --------------------------#}
      {% set counterClasses = "hidden md:flex flex-shrink-0 typography-body-regular text-[var(--color-interactive-default)]" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <div
        class="{{ containerClasses }}"
        data-pagination-name="{{ paginationName }}"
        data-pagination-type="pagination"
      >
        {# Items per page selector (if selectName provided) #}
        {# TODO Phase 6c: Requires utils/block-grid.js
        - Select onChange triggers client-side re-render
        - Fetch all articles data via JSON
        - Apply new itemsPerPage filter
        - Update pagination navigation
        - Progressive enhancement (SSG fallback) #}
        {% if selectName and options.selectDatas %}
          <div
            class="{{ selectWrapperClasses }}"
            data-pagination-selector="true"
          >
            {{ renderSelect({
                name: selectName,
                datas: options.selectDatas
            }) }}
          </div>
        {% endif %}

        {# Navigation #}
        {% if totalPages > 1 %}
          <nav
            class="{{ navWrapperClasses }}"
            role="navigation"
            aria-label="Pagination"
            data-pagination-nav="true"
          >
            <ul class="{{ navListClasses }}">

              {# First page button #}
              {% if icons.first %}
                <li class="{{ navItemClasses }}">

                  <a href="{{ paginationHref.first }}"
                    class="{{ navLinkBaseClasses }} {% if not paginationHref.previous %}{{ navLinkDisabledClasses }}{% endif %}"
                    aria-label="First page"
                    {% if not paginationHref.previous %}aria-disabled="true"{% endif %}
                  >
                    {{ renderIcon({
                        name: icons.first,
                        datas: options.iconDatas
                    }) | safe }}
                  </a>
                </li>
              {% endif %}

              {# Previous page button #}
              {% if icons.prev %}
                <li class="{{ navItemClasses }}">

                  <a href="{{ paginationHref.previous or paginationHref.first }}"
                    class="{{ navLinkBaseClasses }} {% if not paginationHref.previous %}{{ navLinkDisabledClasses }}{% endif %}"
                    aria-label="Previous page"
                    {% if not paginationHref.previous %}aria-disabled="true"{% endif %}
                  >
                    {{ renderIcon({
                        name: icons.prev,
                        datas: options.iconDatas
                    }) | safe }}
                  </a>
                </li>
              {% endif %}

              {# Page numbers with sibling logic #}
              {% set startPage = [1, currentPageNumber - siblingCount] | max %}
              {% set endPage = [totalPages, currentPageNumber + siblingCount] | min %}

              {# First page if not in range #}
              {% if startPage > 1 %}
                <li class="{{ navItemClasses }}">

                  <a  href="{{ paginationHrefs[0] }}"
                    class="{{ navLinkBaseClasses }}"
                  >
                    1
                  </a>
                </li>
              {% endif %}

              {# Dots before siblings #}
              {% if startPage > 2 %}
                <li class="{{ navItemClasses }}">
                  <span class="{{ navLinkBaseClasses }} {{ navLinkDisabledClasses }}">
                    {% if icons.dots %}
                      {{ renderIcon({
                          name: icons.dots,
                          datas: options.iconDatas
                      }) | safe }}
                    {% else %}
                      ...
                    {% endif %}
                  </span>
                </li>
              {% endif %}

              {# Sibling pages #}
              {% for pageNum in range(startPage, endPage + 1) %}
                <li class="{{ navItemClasses }}">

                  <a  href="{{ paginationHrefs[pageNum - 1] }}"
                    class="{{ navLinkBaseClasses }} {% if pageNum == currentPageNumber %}{{ navLinkActiveClasses }}{% endif %}"
                    {% if pageNum == currentPageNumber %}aria-current="page"{% endif %}
                  >
                    {{ pageNum }}
                  </a>
                </li>
              {% endfor %}

              {# Dots after siblings #}
              {% if endPage < totalPages - 1 %}
                <li class="{{ navItemClasses }}">
                  <span class="{{ navLinkBaseClasses }} {{ navLinkDisabledClasses }}">
                    {% if icons.dots %}
                      {{ renderIcon({
                          name: icons.dots,
                          datas: options.iconDatas
                      }) | safe }}
                    {% else %}
                      ...
                    {% endif %}
                  </span>
                </li>
              {% endif %}

              {# Last page if not in range #}
              {% if endPage < totalPages %}
                <li class="{{ navItemClasses }}">

                  <a  href="{{ paginationHrefs[totalPages - 1] }}"
                    class="{{ navLinkBaseClasses }}"
                  >
                    {{ totalPages }}
                  </a>
                </li>
              {% endif %}

              {# Next page button #}
              {% if icons.next %}
                <li class="{{ navItemClasses }}">

                  <a  href="{{ paginationHref.next or paginationHref.last }}"
                    class="{{ navLinkBaseClasses }} {% if not paginationHref.next %}{{ navLinkDisabledClasses }}{% endif %}"
                    aria-label="Next page"
                    {% if not paginationHref.next %}aria-disabled="true"{% endif %}
                  >
                    {{ renderIcon({
                        name: icons.next,
                        datas: options.iconDatas
                    }) | safe }}
                  </a>
                </li>
              {% endif %}

              {# Last page button #}
              {% if icons.last %}
                <li class="{{ navItemClasses }}">

                  <a  href="{{ paginationHref.last }}"
                    class="{{ navLinkBaseClasses }} {% if not paginationHref.next %}{{ navLinkDisabledClasses }}{% endif %}"
                    aria-label="Last page"
                    {% if not paginationHref.next %}aria-disabled="true"{% endif %}
                  >
                    {{ renderIcon({
                        name: icons.last,
                        datas: options.iconDatas
                    }) | safe }}
                  </a>
                </li>
              {% endif %}

            </ul>
          </nav>
        {% endif %}

        {# Items counter (if enabled) #}
        {% if showCounter and totalItems > 0 %}
          <div
            class="{{ counterClasses }}"
            data-pagination-counter="true"
          >
            <span>
              {{ firstItem }}-{{ lastItem }} of {{ totalItems }}
            </span>
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
