{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Breadcrumb                                   │
   │ Navigation breadcrumb trail with link states            │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/breadcrumb.njk" import renderBreadcrumb %}
    
    {{ renderBreadcrumb({ 
        name: "adventure",
        datas: molecules.breadcrumbs,
        links: atoms.links 
    }) }}
    
    With custom styles:
    {{ renderBreadcrumb({ 
        datas: molecules.breadcrumbs,
        links: atoms.links,
        class: "my-custom-breadcrumb-class"
    }) }}
  
  Props:
    - options.name (string): Breadcrumb set identifier (optional)
    - options.datas (object): Breadcrumb configuration
    - options.links (object): Links atom data
    - options.class (string): Additional CSS classes
  
  Features:
    - Separator icon between items (default: /)
    - Active item styling for current page
    - Hover/focus states for clickable links
    - Falls back to first breadcrumb set if name not found
  
  Accessibility:
    - Semantic <nav> with aria-label="Breadcrumb"
    - Ordered list structure
    - aria-hidden for separator icons
  
  @created 2025-01-15
#}

{% macro renderBreadcrumb(options) %}
  {% if options.datas %}
    {% set globalStyle = options.datas.globalStyle %}
    {% set separatorStyle = options.datas.separatorStyle | default('') %}
    {% set separatorIcon = options.datas.separatorIcon | default('/') %}
    {% set activeItemStyle = options.datas.activeItemStyle | default('') %}
    
    {% set breadcrumbData = null %}
    {% if options.name %}
      {% for crumbSet in options.datas.breadcrumbs %}
        {% if crumbSet.name == options.name %}
          {% set breadcrumbData = crumbSet %}
        {% endif %}
      {% endfor %}
    {% endif %}

    {% if not breadcrumbData %}
      {% set breadcrumbData = options.datas.breadcrumbs[0] %}
    {% endif %}
    
    {% set stateClasses = {
      'default': options.datas.variants.default | default(''),
      'hover': options.datas.variants.hover | default(''),
      'focus': options.datas.variants.focus | default(''),
      'disabled': options.datas.variants.disabled | default('')
    } %}
    
    <nav aria-label="Breadcrumb" class="{{ globalStyle }} {{ options.class | default('') }}">
      <ol>
        {% for crumb in breadcrumbData.links %}
          <li>
            {% if loop.index > 1 %}
              <span class="{{ separatorStyle }}" aria-hidden="true">{{ separatorIcon }}</span>
            {% endif %}
            
            {% if crumb.link and options.links %}
              {# Try to find the corresponding link #}
              {% set linkFound = false %}
              {% for link in options.links.links %}
                {% if link.name == crumb.link %}
                  <a href="{{ link.href }}" 
                     class="{{ stateClasses.default }}"
                     onmouseover="this.className='{{ stateClasses.hover }}'" 
                     onmouseout="this.className='{{ stateClasses.default }}'"
                     onfocus="this.className='{{ stateClasses.focus }}'"
                     onblur="this.className='{{ stateClasses.default }}'">
                    {{ link.text }}
                  </a>
                  {% set linkFound = true %}
                {% endif %}
              {% endfor %}
              
              {% if not linkFound %}
                <span class="{{ stateClasses.default }}">
                  {{ crumb.name }}
                </span>
              {% endif %}
            {% else %}
              <span class="{{ activeItemStyle }}">
                {{ crumb.name }}
              </span>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
    </nav>
  {% else %}
    <span>Breadcrumb data not found</span>
  {% endif %}
{% endmacro %}


{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
Charlotte Carpentier · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}