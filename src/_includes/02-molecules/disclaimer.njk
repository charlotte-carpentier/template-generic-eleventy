{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Disclaimer                                   │
   │ Dismissible alert messages with icon support            │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/disclaimer.njk" import renderDisclaimer %}
    
    {{ renderDisclaimer({ 
        name: "gdpr_consent", 
        datas: molecules.disclaimers,
        icons: atoms.icons 
    }) }}
  
  Props:
    - options.name (string): Disclaimer identifier
    - options.datas (object): Disclaimer configuration
    - options.icons (object): Icons atom data
  
  Features:
    - Style variants (info, warning, error, success)
    - Optional icon display
    - Dismissible with close button
    - Message content from configuration
  
  Accessibility:
    - role="alert" for screen readers
    - aria-live="polite" for dynamic updates
    - aria-label on dismiss button
    - aria-hidden for decorative icons
  
  @created 2025-01-15
#}

{% macro renderDisclaimer(options) %}
  {% if options.datas %}
    {% set disclaimerData = null %}
    
    {% if options.name %}
      {% for disclaimer in options.datas.disclaimers %}
        {% if disclaimer.name == options.name %}
          {% set disclaimerData = disclaimer %}
        {% endif %}
      {% endfor %}
    {% endif %}

    {% if not disclaimerData %}
      <span>Disclaimer not found: {{ options.name }}</span>
    {% else %}
      {% set globalStyle = options.datas.globalStyle %}
      {% set variantStyle = options.datas.variants[disclaimerData.style] %}
      {% set iconStyle = options.datas.iconStyles.default %}
      
      {% set iconData = null %}
      {% if disclaimerData.icon and options.icons %}
        {% for icon in options.icons.icons %}
          {% if icon.name == disclaimerData.icon %}
            {% set iconData = icon %}
          {% endif %}
        {% endfor %}
      {% endif %}

      <div 
        aria-live="polite" 
        role="alert"
        data-disclaimer="{{ options.name }}"
      >
        <div 
          class="{{ globalStyle }} {{ variantStyle }}"
        >
          <div>
            <div>
              {% if iconData %}
                <span 
                  data-svg-src="{{ iconData.path }}" 
                  class="{{ iconStyle }}" 
                  aria-hidden="true"
                ></span>
              {% endif %}
              <span>{{ disclaimerData.message }}</span>
            </div>
            
            <button 
              data-dismiss
              aria-label="Dismiss disclaimer"
            >
              &times;
            </button>
          </div>
        </div>
      </div>
    {% endif %}
  {% else %}
    <span>No disclaimer data provided</span>
  {% endif %}
{% endmacro %}


{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
Charlotte Carpentier · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}