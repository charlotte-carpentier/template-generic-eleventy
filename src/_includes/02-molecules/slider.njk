{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Slider                                       │
   │ Single value and range sliders with handle indicators   │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Slider identifier
    - options.datas (array): Slider configuration data

  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/slider.njk" import renderSlider %}

    {{ renderSlider({
        name: "demoSlider1",
        datas: molecules.slider.sliders
    }) }}

  JavaScript Requirements:
    - slider.js molecule (calculates positions, updates values, handles drag)
    - JS MUST implement keyboard: Right/Up increment, Left/Down decrement, Home min, End max, Page Up/Down large steps
    - JS MUST update aria-valuenow and aria-valuetext on change
    - JS MUST update aria-valuetext with unit if provided

  @created 2025-01-15
  @updated 2026-01-06 (WCAG 2.2 AA compliance)
#}

{% macro renderSlider(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find slider using universal filter #}
    {% set sliderData = options.datas | findByName(options.name) %}

    {# Render slider or error message #}
    {% if not sliderData %}
      <span class="error" role="alert">Slider not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set sliderName = sliderData.name | default(options.name) %}
      {% set sliderType = sliderData.type | default('single') %}
      {% set label = sliderData.label | default('') %}
      {% set minValue = sliderData.min | default(0) %}
      {% set maxValue = sliderData.max | default(100) %}
      {% set step = sliderData.step | default(1) %}
      {% set unit = sliderData.unit | default('') %}
      {% set showIndicator = sliderData.showIndicator | default(false) %}
      {% set indicatorVariant = sliderData.indicatorVariant | default('outline') %}

      {# Initial values (JS will position handles) #}
      {% if sliderType == 'single' %}
        {% set value = sliderData.value | default(minValue) %}
      {% else %}
        {% set valueMin = sliderData.valueMin | default(minValue) %}
        {% set valueMax = sliderData.valueMax | default(maxValue) %}
      {% endif %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Wrapper Classes
        3.2 Label Classes
        3.3 Track Wrapper Classes
        3.4 Track Classes
        3.5 Fill Classes
        3.6 Handle Classes
        3.7 Indicator Classes
        3.8 Min/Max Wrapper Classes
        3.9 Min/Max Text Classes
        3.10 Instructions Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Wrapper Classes
          Description: Layout vertical, Spacing
        --------------------------#}
      {% set containerClasses = "flex flex-col gap-[var(--spacing-stack-tight)]" %}

      {# --------------------------
          3.2 Label Classes
          Description: Typography, Colors
        --------------------------#}
      {% set labelTextClasses = "font-body text-body text-[var(--color-global-default)]" %}

      {# --------------------------
          3.3 Track Wrapper Classes
          Description: Relative positioning for handles
        --------------------------#}
      {% set trackWrapperClasses = "relative w-full py-[var(--spacing-stack-tight)]" %}

      {# --------------------------
          3.4 Track Classes
          Description: Background bar, Colors, Borders
        --------------------------#}
      {% set trackClasses = "relative w-full h-2 bg-[var(--color-global-contrast-light-03)] rounded-full" %}

      {# --------------------------
          3.5 Fill Classes
          Description: Filled portion, Colors, Position (JS-controlled)
        --------------------------#}
      {% set fillClasses = "absolute top-0 h-full bg-[var(--color-interactive-default)] rounded-full transition-all duration-300" %}

      {# --------------------------
          3.6 Handle Classes
          Description: Draggable handle, Position (JS-controlled), Size, Borders
        --------------------------#}
      {% set handleBaseClasses = "absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-5 h-5 p-3 border-2 rounded-full cursor-grab active:cursor-grabbing shadow-md" %}
      {% set handleStateClasses = "bg-[var(--color-global-white)] border-[var(--color-interactive-default)] transition-all hover:scale-110 focus:outline-none focus:ring-2 focus:ring-[var(--color-semantic-information-focus)] focus:ring-offset-2" %}

      {# --------------------------
          3.7 Indicator Classes
          Description: Handle indicator bubble (JS-controlled value)
        --------------------------#}
      {% set indicatorBaseClasses = "absolute -top-10 left-1/2 -translate-x-1/2 px-[var(--spacing-inline-medium)] py-[var(--spacing-inline-tight)] font-body text-sm rounded-[var(--radius-default)] shadow-sm whitespace-nowrap" %}

      {% set indicatorVariantMap = {
        'outline': 'text-[var(--color-global-default)] bg-[var(--color-global-white)] border border-[var(--color-global-contrast-light-03)]',
        'solid': 'text-[var(--color-global-white)] bg-[var(--color-interactive-default)]'
      } %}
      {% set indicatorVariantClasses = indicatorVariantMap[indicatorVariant] or indicatorVariantMap['outline'] %}

      {# --------------------------
          3.8 Min/Max Wrapper Classes
          Description: Layout horizontal, Space between
        --------------------------#}
      {% set minMaxWrapperClasses = "flex items-center justify-between" %}

      {# --------------------------
          3.9 Min/Max Text Classes
          Description: Typography, Colors
        --------------------------#}
      {% set minMaxTextClasses = "font-body text-sm text-[var(--color-global-contrast-light-01)]" %}

      {# --------------------------
          3.10 Instructions Classes
          Description: Screen reader only
        --------------------------#}
      {% set instructionsClasses = "sr-only" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <div
        class="{{ containerClasses }}"
        data-slider="true"
        data-slider-name="{{ sliderName }}"
        data-slider-type="{{ sliderType }}"
        data-slider-min="{{ minValue }}"
        data-slider-max="{{ maxValue }}"
        data-slider-step="{{ step }}"
        {% if unit %}data-slider-unit="{{ unit }}"{% endif %}
        {% if sliderType == 'single' %}
          data-slider-value="{{ value }}"
        {% else %}
          data-slider-value-min="{{ valueMin }}"
          data-slider-value-max="{{ valueMax }}"
        {% endif %}
      >
        {# Label #}
        {% if label %}
          <label
            class="{{ labelTextClasses }}"
            data-slider-label="true"
          >
            {{ label }}
          </label>
        {% endif %}

        {# Keyboard instructions for screen readers #}
        <div class="{{ instructionsClasses }}" id="slider-instructions-{{ sliderName }}">
          Use arrow keys to adjust. Home and End keys for minimum and maximum values. Page Up and Page Down for larger steps.
        </div>

        {# Track with handles #}
        <div
          class="{{ trackWrapperClasses }}"
          data-slider-track-wrapper="true"
        >
          <div
            class="{{ trackClasses }}"
            data-slider-track="true"
          >
            {# Fill (JS sets left + width) #}
            <div
              class="{{ fillClasses }}"
              data-slider-fill="true"
            ></div>

            {# Handle 1 (JS sets left position) #}
            <div
              class="{{ handleBaseClasses }} {{ handleStateClasses }}"
              data-slider-handle="true"
              data-slider-handle-index="0"
              {% if sliderType == 'range' %}id="slider-{{ sliderName }}-min"{% endif %}
              tabindex="0"
              role="slider"
              aria-label="{% if sliderType == 'single' %}{{ label | default('Slider') }}{% else %}{{ label | default('Slider') }} minimum{% endif %}"
              aria-orientation="horizontal"
              aria-valuemin="{{ minValue }}"
              aria-valuemax="{{ maxValue }}"
              {% if sliderType == 'single' %}
                aria-valuenow="{{ value }}"
                aria-valuetext="{{ value }}{% if unit %} {{ unit }}{% endif %}"
              {% else %}
                aria-valuenow="{{ valueMin }}"
                aria-valuetext="{{ valueMin }}{% if unit %} {{ unit }}{% endif %}"
                aria-controls="slider-{{ sliderName }}-max"
              {% endif %}
              aria-describedby="slider-instructions-{{ sliderName }}"
            >
              {# Indicator for handle 1 (JS updates value) #}
              {% if showIndicator %}
                <span
                  class="{{ indicatorBaseClasses }} {{ indicatorVariantClasses }}"
                  data-slider-indicator="true"
                  role="status"
                  aria-live="polite"
                  aria-atomic="true"
                >
                  {% if sliderType == 'single' %}{{ value }}{% else %}{{ valueMin }}{% endif %}{% if unit %} {{ unit }}{% endif %}
                </span>
              {% endif %}
            </div>

            {# Handle 2 for range slider (JS sets left position) #}
            {% if sliderType == 'range' %}
              <div
                class="{{ handleBaseClasses }} {{ handleStateClasses }}"
                data-slider-handle="true"
                data-slider-handle-index="1"
                id="slider-{{ sliderName }}-max"
                tabindex="0"
                role="slider"
                aria-label="{{ label | default('Slider') }} maximum"
                aria-orientation="horizontal"
                aria-valuemin="{{ minValue }}"
                aria-valuemax="{{ maxValue }}"
                aria-valuenow="{{ valueMax }}"
                aria-valuetext="{{ valueMax }}{% if unit %} {{ unit }}{% endif %}"
                aria-controls="slider-{{ sliderName }}-min"
                aria-describedby="slider-instructions-{{ sliderName }}"
              >
                {# Indicator for handle 2 (JS updates value) #}
                {% if showIndicator %}
                  <span
                    class="{{ indicatorBaseClasses }} {{ indicatorVariantClasses }}"
                    data-slider-indicator="true"
                    role="status"
                    aria-live="polite"
                    aria-atomic="true"
                  >
                    {{ valueMax }}{% if unit %} {{ unit }}{% endif %}
                  </span>
                {% endif %}
              </div>
            {% endif %}
          </div>
        </div>

        {# Min/Max labels #}
        <div
          class="{{ minMaxWrapperClasses }}"
          data-slider-labels="true"
        >
          <span class="{{ minMaxTextClasses }}" data-slider-min-label="true">{{ minValue }}{% if unit %} {{ unit }}{% endif %}</span>
          <span class="{{ minMaxTextClasses }}" data-slider-max-label="true">{{ maxValue }}{% if unit %} {{ unit }}{% endif %}</span>
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
