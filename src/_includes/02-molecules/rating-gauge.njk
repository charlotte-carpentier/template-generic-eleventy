{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Rating Gauge                                 │
   │ Star rating display with customizable icons             │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/rating-gauge.njk" import renderRatingGauge %}
    {{ renderRatingGauge({ 
        name: "three_star",
        datas: molecules["rating-gauges"],
        icons: atoms.icons
    }) }}
    
    With numeric value:
    {{ renderRatingGauge({ 
        name: "four_star",
        showValue: true,
        datas: molecules["rating-gauges"],
        icons: atoms.icons
    }) }}
  
  Props:
    - options.name (string): Rating identifier
    - options.datas (object): Rating configuration
    - options.icons (object): Icons atom data
    - options.showValue (boolean): Display numeric value
    - options.class (string): Additional CSS classes
  
  Features:
    - Customizable star icons (filled/empty)
    - SVG loading via data-svg-src
    - Fallback text stars (★/☆)
    - Optional numeric value display
    - Style variants per rating level
  
  Accessibility:
    - aria-hidden on decorative icons
    - Descriptive alt text on image fallbacks
  
  @created 2025-01-15
#}

{% macro renderRatingGauge(options) %}
  {% if not options or not options.datas %}
    <p>Error: Missing required data for rating gauge</p>
  {% else %}
    {% set globalStyle = options.datas.globalStyle | default('') %}
    {% set ratingData = null %}
    
    {# Find the specific rating by name if provided #}
    {% if options.name %}
      {% for rating in options.datas.ratingLevels %}
        {% if rating.name == options.name %}
          {% set ratingData = rating %}
        {% endif %}
      {% endfor %}
    {% else %}
      {# Use first rating as default #}
      {% set ratingData = options.datas.ratingLevels[0] %}
    {% endif %}
    
    {% if not ratingData %}
      <p>Error: Rating "{{ options.name }}" not found</p>
    {% else %}
      <div class="{{ globalStyle }} {{ options.class | default('') }}">
        {% for star in ratingData.stars %}
          {% set iconData = null %}
          
          {# Find icon data if icons are provided #}
          {% if options.icons and options.icons.icons %}
            {% for icon in options.icons.icons %}
              {% if icon.name == star %}
                {% set iconData = icon %}
              {% endif %}
            {% endfor %}
          {% endif %}
          
          {# Apply the appropriate style based on the star type #}
          {% set starStyle = options.datas.variants[ratingData.style] | default('') %}
          {% set iconStyle = options.datas.iconStyles.default | default('') %}
          
          <span class="{{ starStyle }}">
            {% if iconData and iconData.path %}
              {# Render SVG with data-svg-src for SVG loader #}
              {% if iconData.path.endsWith('.svg') %}
                <span 
                  data-svg-src="{{ iconData.path }}" 
                  class="{{ iconStyle }}"
                  aria-hidden="true"
                ></span>
              {% else %}
                {# Standard image fallback #}
                <img 
                  src="{{ iconData.path }}" 
                  alt="{{ iconData.alt | default('Rating star') }}" 
                  class="{{ iconStyle }}"
                >
              {% endif %}
            {% else %}
              {# Fallback for missing icons #}
              <span class="{{ iconStyle }}">
                {% if star == 'star-filled' %}★{% else %}☆{% endif %}
              </span>
            {% endif %}
          </span>
        {% endfor %}
        
        {# Optional numeric value #}
        {% if options.showValue and ratingData.value %}
          <span>
            {{ ratingData.value }}
          </span>
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
Charlotte Carpentier · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}