{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Card                                         │
   │ Content cards with lockup, heading, and action support  │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Card identifier
    - options.datas (array): Card configuration data
    - options.lockupDatas (array): Lockup atom data (optional)
    - options.headingDatas (array): Heading atom data (optional)
    - options.buttonDatas (array): Button atom data (optional)
    - options.tagDatas (array): Tag atom data (optional)

  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/card.njk" import renderCard %}

    {{ renderCard({
        name: "demoCard1",
        datas: molecules.card.cards,
        lockupDatas: molecules.lockup.lockups,
        headingDatas: atoms.heading.headings,
        buttonDatas: atoms.button.buttons,
        tagDatas: atoms.tag.tags
    }) }}

  @created 2025-01-15
#}

{% from "02-molecules/lock-up.njk" import renderLockup %}
{% from "01-atoms/heading.njk" import renderHeading %}
{% from "01-atoms/button.njk" import renderButton %}
{% from "01-atoms/tag.njk" import renderTag %}

{% macro renderCard(options) %}
  {# Validate required props #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find card using universal filter (supports both name and id) #}
    {% set cardData = options.datas | findByName(options.name) %}

    {# Render or error #}
    {% if not cardData %}
      <span class="error" role="alert">Card not found: {{ options.name }}</span>
    {% else %}
      <div
        data-card-id="{{ cardData.id }}"
        data-card-type="card"
      >
        {# Lockup (if present and lockupDatas provided) #}
        {% if cardData.lockupName and options.lockupDatas %}
          <div data-card-lockup="true">
            {{ renderLockup({
                name: cardData.lockupName,
                datas: options.lockupDatas
            }) }}
          </div>
        {% endif %}

        {# Content wrapper #}
        <div data-card-content="true">
          {# Heading (if present) #}
          {% if cardData.headingName and options.headingDatas %}
            {{ renderHeading({
                name: cardData.headingName,
                datas: options.headingDatas
            }) }}
          {% endif %}

          {# Content text (if present) #}
          {% if cardData.content %}
            <p data-card-text="true">
              {{ cardData.content }}
            </p>
          {% endif %}

          {# Button (if present) #}
          {% if cardData.buttonName and options.buttonDatas %}
            {{ renderButton({
                name: cardData.buttonName,
                datas: options.buttonDatas
            }) }}
          {% endif %}

          {# Tags (if present) #}
          {% if cardData.tags and options.tagDatas %}
            <div data-card-tags="true">
              {% for tagName in cardData.tags %}
                {{ renderTag({
                    name: tagName,
                    datas: options.tagDatas
                }) }}
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
