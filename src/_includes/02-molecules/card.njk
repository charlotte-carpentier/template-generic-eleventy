{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Card                                         │
   │ Content cards with lockup, heading, and action support  │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Card identifier
    - options.datas (array): Card configuration data
    - options.imageSrc (string): Runtime image override (optional)
    - options.imageAlt (string): Runtime alt text override (optional)
    - options.headingText (string): Runtime heading text override (optional)
    - options.content (string): Runtime content text override (optional)
    - options.buttonName (string): Runtime button name override (optional)
    - options.buttonUrl (string): Runtime button URL override (optional)
    - options.lockupDatas (array): Lockup molecule data (optional)
    - options.imageDatas (array): Image atom data (optional)
    - options.headingDatas (array): Heading atom data (optional)
    - options.buttonDatas (array): Button atom data (optional)
    - options.tagDatas (array): Tag atom data (optional)
    - options.iconDatas (array): Icon atom data (required if button has icons)
    - options.tooltipDatas (array): Tooltip atom data (optional, required if buttons have tooltips)

  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/card.njk" import renderCard %}

    Usage — Summon HAT Components Wisely:
    {% from "02-molecules/card.njk" import renderCard %}

    {{ renderCard({
        name: "demoCard1",
        datas: molecules.card.cards,
        imageSrc: article.data.image,
        imageAlt: article.data.imageAlt,
        headingText: article.data.title,
        buttonUrl: article.url,
        lockupDatas: molecules["lock-up"].lockUps,
        imageDatas: atoms.image.images,
        headingDatas: atoms.heading.headings,
        buttonDatas: atoms.button.buttons,
        iconDatas: atoms.icon.icons
    }) }}

  @created 2025-09-15
#}

{% from "02-molecules/lock-up.njk" import renderLockup %}
{% from "01-atoms/heading.njk" import renderHeading %}
{% from "01-atoms/button.njk" import renderButton %}
{% from "01-atoms/tag.njk" import renderTag %}

{% macro renderCard(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find card using universal filter (supports both name and id) #}
    {% set cardData = options.datas | findByName(options.name) %}

    {# Render card or error message #}
    {% if not cardData %}
      <span class="error" role="alert">Card not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set lockupName = cardData.lockupName | default('') %}
      {% set headingName = cardData.headingName | default('') %}
      {% set content = options.content or cardData.content or '' %}
      {% set buttonName = options.buttonName or cardData.buttonName or '' %}
      {% set tags = cardData.tags | default([]) %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Wrapper Classes
        3.2 Lockup Wrapper Classes
        3.3 Content Wrapper Classes
        3.4 Text Classes
        3.5 Button Wrapper Classes
        3.6 Tags Wrapper Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Wrapper Classes
          Description: Layout, Background, Borders, Effects, States
        --------------------------#}
      {% set cardClasses = "flex flex-col bg-[var(--color-global-white)] rounded-[var(--radius-card)] shadow-[var(--elevation-surface)] overflow-hidden transition-shadow hover:shadow-[var(--elevation-interactive)]" %}

      {# --------------------------
          3.2 Lockup Wrapper Classes
          Description: Layout override for full-width image, text truncation
        --------------------------#}
      {% set lockupClasses = "[&>div]:flex-col [&>div]:gap-[var(--spacing-ui-minimal)] [&_[data-lockup-image]]:w-full [&_[data-lockup-image]]:aspect-video [&_[data-lockup-image]]:min-h-[180px] [&_img]:w-full [&_img]:h-full [&_img]:object-cover [&_img]:rounded-t-[var(--radius-card)] [&_img]:rounded-b-none [&_[data-lockup-content]]:p-[var(--spacing-ui-comfortable)] [&_[data-lockup-text]]:line-clamp-2" %}

      {# --------------------------
          3.3 Content Wrapper Classes
          Description: Layout, Spacing, Typography override h4-serif
      --------------------------#}
      {% set contentClasses = "flex flex-col gap-[var(--spacing-ui-minimal)] p-[var(--spacing-ui-default)] [&_h2]:font-heading-serif [&_h2]:text-h4" %}

      {# --------------------------
          3.4 Text Classes
          Description: Typography, Colors, Text truncation (2 lines)
        --------------------------#}
      {% set textClasses = "font-body text-body text-[var(--color-global-default)] line-clamp-2" %}

      {# --------------------------
          3.5 Button Wrapper Classes
          Description: Layout (full-width button)
        --------------------------#}
      {% set buttonWrapperClasses = "mt-0 [&_button]:w-full [&_a]:w-full" %}

      {# --------------------------
          3.6 Tags Wrapper Classes
          Description: Layout, Spacing
        --------------------------#}
      {% set tagsClasses = "flex flex-wrap gap-[var(--spacing-micro-default)] mt-[var(--spacing-ui-minimal)]" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <div
        class="{{ cardClasses }}"
        data-card-name="{{ cardData.name }}"
        data-card-type="card"
      >
        {# Lockup (if present and lockupDatas provided) #}
        {% if lockupName and options.lockupDatas %}
          <div
            class="{{ lockupClasses }}"
            data-card-lockup="true"
          >
            {{ renderLockup({
                name: lockupName,
                imageSrc: options.imageSrc,
                imageAlt: options.imageAlt,
                headingText: options.headingText,
                contentText: options.content,
                datas: options.lockupDatas,
                imageDatas: options.imageDatas,
                headingDatas: options.headingDatas,
                iconDatas: options.iconDatas
            }) }}
          </div>
        {% endif %}

        {# Content wrapper #}
        <div
          class="{{ contentClasses }}"
          data-card-content="true"
        >
          {# Heading (if present) #}
          {% if headingName and options.headingDatas %}
            {{ renderHeading({
                name: headingName,
                datas: options.headingDatas,
                text: options.headingText
            }) }}
          {% endif %}

          {# Button (if present) #}
          {% if buttonName and options.buttonDatas %}
            <div class="{{ buttonWrapperClasses }}">
              {{ renderButton({
                  name: buttonName,
                  datas: options.buttonDatas,
                  url: options.buttonUrl,
                  iconDatas: options.iconDatas,
                  tooltipDatas: options.tooltipDatas
              }) }}
            </div>
          {% endif %}

          {# Tags (if present) #}
          {% if tags and tags | length > 0 and options.tagDatas %}
            <div
              class="{{ tagsClasses }}"
              data-card-tags="true"
            >
              {% for tagName in tags %}
                {{ renderTag({
                    name: tagName,
                    datas: options.tagDatas
                }) }}
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
