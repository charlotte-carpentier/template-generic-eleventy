{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Panel                                        │
   │ Dropdown panels with default, date, and list variants   │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Panel identifier
    - options.datas (array): Panel configuration data
    - options.checkboxDatas (array): Checkbox atom data (optional)
    - options.iconDatas (array): Icon atom data (optional)

  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/panel.njk" import renderPanel %}

    {{ renderPanel({
        name: "demoPanel1",
        datas: molecules.panel.panels,
        checkboxDatas: atoms.checkbox.checkboxes,
        iconDatas: atoms.icon.icons
    }) }}

  JavaScript Requirements:
    - Type "date": panel.js molecule (generates labels, calendars, navigation)
    - Type "list-item": No JavaScript required (static presentation)

  @created 2025-01-15
  @updated 2025-01-18 (Phase 6 - Dynamic rendering with classes from Nunjucks)
#}

{% from "01-atoms/checkbox.njk" import renderCheckbox %}
{% from "01-atoms/icon.njk" import renderIcon %}

{% macro renderPanel(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find panel using universal filter #}
    {% set panelData = options.datas | findByName(options.name) %}

    {# Render panel or error message #}
    {% if not panelData %}
      <span class="error" role="alert">Panel not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set panelName = panelData.name | default(options.name) %}
      {% set panelType = panelData.type | default('default') %}
      {% set variant = panelData.variant | default('simple') %}
      {% set items = panelData.items | default([]) %}
      {% set navigation = panelData.navigation | default({}) %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Container Classes
        3.2 Item Classes
        3.3 Icon Wrapper Classes
        3.4 Text Classes
        3.5 Code Classes
        3.6 Date Navigation Classes
        3.7 Calendar Classes (for JS dynamic generation)
        3.8 Month Labels Wrapper Classes
        3.9 Calendars Wrapper Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Container Classes
          Description: Layout, Background, Borders, Shadow
        --------------------------#}
      {% set containerClasses = "flex flex-col bg-[var(--color-global-white)] border border-[var(--color-global-contrast-light-03)] rounded-[var(--radius-default)] shadow-md p-[var(--spacing-inset-tight)]" %}

      {# --------------------------
          3.2 Item Classes
          Description: Layout, Spacing, Borders
        --------------------------#}
      {% set itemStateClasses = "transition-colors hover:[&>span]:text-[var(--color-global-accent)] hover:[&_svg]:text-[var(--color-global-accent)] focus:outline-none focus:border-2 focus:border-[var(--color-semantic-information-focus)] [aria-disabled='true']:bg-[var(--color-global-contrast-light-04)] [aria-disabled='true']:text-[var(--color-global-contrast-light-02)] [aria-disabled='true']:cursor-not-allowed [aria-disabled='true']:pointer-events-none" %}

      {# --------------------------
          3.3 Icon Wrapper Classes
          Description: Layout, Size
        --------------------------#}
      {% set iconWrapperClasses = "flex-shrink-0 inline-flex items-center w-6 h-6" %}

      {# --------------------------
          3.4 Text Classes
          Description: Typography, Layout
        --------------------------#}
      {% set textClasses = "typography-body-regular text-[var(--color-global-default)] flex-1" %}

      {# --------------------------
          3.5 Code Classes
          Description: Typography, Colors
        --------------------------#}
      {% set codeClasses = "typography-body-small text-[var(--color-global-contrast-light-01)] ml-auto" %}

      {# --------------------------
          3.6 Date Navigation Classes
          Description: Layout, Spacing, Alignment
        --------------------------#}
      {% set dateNavClasses = "flex items-center justify-between px-[var(--spacing-inline-medium)] py-[var(--spacing-stack-small)] border-b border-[var(--color-global-contrast-light-03)]" %}
      {% set dateNavButtonBaseClasses = "inline-flex items-center justify-center w-8 h-8 bg-transparent border-0 rounded-[var(--radius-default)] cursor-pointer" %}
      {% set dateNavButtonStateClasses = "text-[var(--color-interactive-default)] transition-colors hover:bg-[var(--color-global-contrast-light-04)] focus:outline-none focus:border-2 focus:border-[var(--color-semantic-information-focus)]" %}

      {# --------------------------
          3.7 Calendar Classes
          Description: Passed to panel.js via data-class-* attributes
        --------------------------#}
      {% set calendarClasses = "p-[var(--spacing-inset-small)]" %}
      {% set calendarHeaderClasses = "grid grid-cols-7 gap-1 mb-2" %}
      {% set calendarDayHeaderClasses = "text-center typography-body-small text-[var(--color-global-contrast-light-01)] py-2" %}
      {% set calendarGridClasses = "grid grid-cols-7 gap-1" %}
      {% set calendarDateCurrentClasses = "flex items-center justify-center w-10 h-10 typography-body-regular rounded-[var(--radius-default)] cursor-pointer text-[var(--color-global-default)] transition-colors hover:text-[var(--color-global-accent)] focus:outline-none focus:border-2 focus:border-[var(--color-semantic-information-focus)]" %}
      {% set calendarDateOutsideClasses = "flex items-center justify-center w-10 h-10 typography-body-regular text-[var(--color-global-contrast-light-01)] rounded-[var(--radius-default)] cursor-default" %}
      {% set calendarDateSelectedClasses = "bg-[var(--color-interactive-default)] text-[var(--color-global-white)] hover:bg-[var(--color-interactive-hover)] hover:text-[var(--color-global-white)]" %}

      {# --------------------------
          3.8 Month Label Classes
          Description: Typography for month labels
        --------------------------#}
      {% set monthLabelsWrapperClasses = "flex gap-60 flex-1 justify-center" %}
      {% set monthLabelClasses = "typography-body-semibold text-[var(--color-global-default)]" %}

      {# --------------------------
          3.9 Calendars Wrapper Classes
          Description: Single vs double calendar layout
        --------------------------#}
      {% if variant == 'double' %}
        {% set calendarsWrapperClasses = "flex gap-[var(--spacing-inset-small)]" %}
      {% else %}
        {% set calendarsWrapperClasses = "" %}
      {% endif %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <div
        class="{{ containerClasses }}"
        data-panel-name="{{ panelName }}"
        data-panel-type="{{ panelType }}"
        data-panel-variant="{{ variant }}"
        role="listbox"
        aria-label="Panel {{ panelName }}"
      >
        {# Default type panels #}
        {% if panelType == "default" %}
          {% for item in items %}
            <div
              class="{{ itemStateClasses }}"
              data-panel-item="true"
              role="option"
              tabindex="0"
            >
              {# Checkbox handles own label #}
              {% if item.checkboxName and options.checkboxDatas %}
                {{ renderCheckbox({
                    id: item.checkboxName,
                    datas: options.checkboxDatas
                }) }}

              {# Icon variant #}
              {% elif item.iconName and options.iconDatas %}
                <div class="{{ iconWrapperClasses }}">
                  {{ renderIcon({
                      name: item.iconName,
                      datas: options.iconDatas
                  }) }}
                </div>
                <span class="{{ textClasses }}">{{ item.text }}</span>
                {% if item.code %}
                  <span
                    class="{{ codeClasses }}"
                    data-panel-code="true"
                  >
                    {{ item.code }}
                  </span>
                {% endif %}

              {# Simple text variant #}
              {% else %}
                <span class="{{ textClasses }}">{{ item.text }}</span>
              {% endif %}
            </div>
          {% endfor %}

        {# Date type panels - Dynamically rendered by panel.js #}
        {% elif panelType == "date" %}
          {# Navigation #}
          {% if navigation %}
            <div class="{{ dateNavClasses }}" data-panel-nav="true">
              <button
                type="button"
                class="{{ dateNavButtonBaseClasses }} {{ dateNavButtonStateClasses }}"
                data-panel-nav-prev="true"
                aria-label="Previous month"
              >
                {{ renderIcon({
                    name: navigation.prevIcon,
                    datas: options.iconDatas
                }) }}
              </button>

              {# Month labels - Generated dynamically by panel.js #}
              <div
                class="{{ monthLabelsWrapperClasses }}"
                data-panel-month-wrapper="true"
                data-class-month-label="{{ monthLabelClasses }}"
              ></div>

              <button
                type="button"
                class="{{ dateNavButtonBaseClasses }} {{ dateNavButtonStateClasses }}"
                data-panel-nav-next="true"
                aria-label="Next month"
              >
                {{ renderIcon({
                    name: navigation.nextIcon,
                    datas: options.iconDatas
                }) }}
              </button>
            </div>
          {% endif %}

          {# Calendars container - Populated by panel.js #}
          <div
            class="{{ calendarsWrapperClasses }}"
            data-panel-calendars="true"
            data-class-calendar="{{ calendarClasses }}"
            data-class-header="{{ calendarHeaderClasses }}"
            data-class-day-header="{{ calendarDayHeaderClasses }}"
            data-class-grid="{{ calendarGridClasses }}"
            data-class-date-current="{{ calendarDateCurrentClasses }}"
            data-class-date-outside="{{ calendarDateOutsideClasses }}"
            data-class-date-selected="{{ calendarDateSelectedClasses }}"
          ></div>

        {# List-item type panels - No JavaScript required #}
        {% elif panelType == "list-item" %}
          {% for item in items %}
            <div
              class="{{ itemStateClasses }}"
              data-panel-item="true"
              role="option"
              tabindex="0"
            >
              {# Checkbox variant #}
              {% if variant == "checkbox" and item.checkboxName and options.checkboxDatas %}
                {{ renderCheckbox({
                    id: item.checkboxName,
                    datas: options.checkboxDatas
                }) }}

              {# Label-icon variant #}
              {% elif variant == "label-icon" and item.iconName and options.iconDatas %}
                <div class="{{ iconWrapperClasses }}">
                  {{ renderIcon({
                      name: item.iconName,
                      datas: options.iconDatas
                  }) }}
                </div>
                <span class="{{ textClasses }}">{{ item.text }}</span>

              {# Label variant #}
              {% elif variant == "label" %}
                <span class="{{ textClasses }}">{{ item.text }}</span>
              {% endif %}
            </div>
          {% endfor %}
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
