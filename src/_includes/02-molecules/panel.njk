{# ┌─────────────────────────────────────────────────────────┐
   │ MOLECULE › Panel                                        │
   │ Dropdown panels with default, date, and list variants   │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Panel identifier
    - options.datas (array): Panel configuration data
    - options.checkboxDatas (array): Checkbox atom data (optional)
    - options.iconDatas (array): Icon atom data (optional)

  Usage — Summon HAT Components Wisely:
    {% from "02-molecules/panel.njk" import renderPanel %}

    {{ renderPanel({
        name: "demoPanel1",
        datas: molecules.panel.panels,
        checkboxDatas: atoms.checkbox.checkboxes,
        iconDatas: atoms.icon.icons
    }) }}

  @created 2025-01-15
#}

{% from "01-atoms/checkbox.njk" import renderCheckbox %}
{% from "01-atoms/icon.njk" import renderIcon %}

{% macro renderPanel(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find panel using universal filter #}
    {% set panelData = options.datas | findByName(options.name) %}

    {# Render panel or error message #}
    {% if not panelData %}
      <span class="error" role="alert">Panel not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set panelName = panelData.name | default(options.name) %}
      {% set panelType = panelData.type | default('default') %}
      {% set variant = panelData.variant | default('simple') %}
      {% set items = panelData.items | default([]) %}
      {% set dateRange = panelData.dateRange | default({}) %}
      {% set navigation = panelData.navigation | default({}) %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Wrapper Classes
        3.2 Item Classes (default/list-item)
        3.3 Icon Wrapper Classes
        3.4 Text Classes
        3.5 Code Classes (phone variant)
        3.6 Date Navigation Classes
        3.7 Calendar Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Wrapper Classes
          Description: Layout, Background, Borders, Shadow
        --------------------------#}
      {% set containerClasses = "flex flex-col bg-[var(--color-global-white)] border border-[var(--color-global-contrast-light-03)] rounded-[var(--radius-default)] shadow-md p-[var(--spacing-inset-tight)]" %}

      {# --------------------------
          3.2 Item Classes (default/list-item)
          Description: Layout horizontal, Spacing, States
        --------------------------#}
      {% set itemClasses = "flex items-center gap-[var(--spacing-inline-medium)] px-[var(--spacing-inset-small)] py-[var(--spacing-stack-tight)] rounded-[var(--radius-default)] transition-colors cursor-pointer hover:[&>span]:text-[var(--color-global-accent)] hover:[&_svg]:text-[var(--color-global-accent)] focus:outline-none focus:border-2 focus:border-[var(--color-semantic-information-focus)] disabled:bg-[var(--color-global-contrast-light-04)] disabled:text-[var(--color-global-contrast-light-02)] disabled:cursor-not-allowed" %}

      {# --------------------------
          3.3 Icon Wrapper Classes
          Description: Layout, Size
        --------------------------#}
      {% set iconWrapperClasses = "flex-shrink-0 inline-flex items-center w-6 h-6" %}

      {# --------------------------
          3.4 Text Classes
          Description: Typography, Layout
        --------------------------#}
      {% set textClasses = "typography-body-regular text-[var(--color-global-default)] flex-1" %}

      {# --------------------------
          3.5 Code Classes (phone variant)
          Description: Typography, Colors
        --------------------------#}
      {% set codeClasses = "typography-body-small text-[var(--color-global-contrast-light-01)] ml-auto" %}

      {# --------------------------
          3.6 Date Navigation Classes
          Description: Layout horizontal, Spacing, Alignment
        --------------------------#}
      {% set dateNavClasses = "flex items-center justify-between px-[var(--spacing-inline-medium)] py-[var(--spacing-stack-small)] border-b border-[var(--color-global-contrast-light-03)]" %}
      {% set dateNavButtonClasses = "inline-flex items-center justify-center w-8 h-8 text-[var(--color-interactive-default)] bg-transparent border-0 rounded-[var(--radius-default)] cursor-pointer transition-colors hover:bg-[var(--color-global-contrast-light-04)] focus:outline-none focus:border-2 focus:border-[var(--color-semantic-information-focus)]" %}
      {% set dateMonthClasses = "typography-body-semibold text-[var(--color-global-default)]" %}

      {# --------------------------
          3.7 Calendar Classes
          Description: Calendar grid layout
        --------------------------#}
      {% set calendarClasses = "p-[var(--spacing-inset-small)]" %}
      {% set calendarHeaderClasses = "grid grid-cols-7 gap-1 mb-2" %}
      {% set calendarDayHeaderClasses = "text-center typography-body-small text-[var(--color-global-contrast-light-01)] py-2" %}
      {% set calendarGridClasses = "grid grid-cols-7 gap-1" %}
      {% set calendarDateClasses = "flex items-center justify-center w-10 h-10 typography-body-regular text-[var(--color-global-default)] rounded-[var(--radius-default)] cursor-pointer transition-colors hover:text-[var(--color-global-accent)] focus:outline-none focus:border-2 focus:border-[var(--color-semantic-information-focus)]" %}
      {% set calendarDateSelectedClasses = "bg-[var(--color-interactive-default)] text-[var(--color-global-white)] hover:bg-[var(--color-interactive-hover)] hover:text-[var(--color-global-white)]" %}
      {% set calendarDateOutsideClasses = "flex items-center justify-center w-10 h-10 typography-body-regular text-[var(--color-global-contrast-light-01)] rounded-[var(--radius-default)] cursor-default" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <div
        class="{{ containerClasses }}"
        data-panel-name="{{ panelName }}"
        data-panel-type="{{ panelType }}"
        data-panel-variant="{{ variant }}"
        role="listbox"
        aria-label="Panel {{ panelName }}"
      >
        {# Default type panels #}
        {% if panelType == "default" %}
          {% for item in items %}
            <div
              class="{{ itemClasses }}"
              data-panel-item="true"
              role="option"
              tabindex="0"
            >
              {# Checkbox variant - checkbox gère son propre label #}
              {% if item.checkboxName and options.checkboxDatas %}
                {{ renderCheckbox({
                    id: item.checkboxName,
                    datas: options.checkboxDatas
                }) }}

              {# Icon variant #}
              {% elif item.iconName and options.iconDatas %}
                <div class="{{ iconWrapperClasses }}">
                  {{ renderIcon({
                      name: item.iconName,
                      datas: options.iconDatas
                  }) }}
                </div>
                <span class="{{ textClasses }}">{{ item.text }}</span>
                {% if item.code %}
                  <span
                    class="{{ codeClasses }}"
                    data-panel-code="true"
                  >
                    {{ item.code }}
                  </span>
                {% endif %}

              {# Simple text variant #}
              {% else %}
                <span class="{{ textClasses }}">{{ item.text }}</span>
              {% endif %}
            </div>
          {% endfor %}

        {# Date type panels #}
        {% elif panelType == "date" %}
          {# Navigation #}
          {% if navigation %}
            <div class="{{ dateNavClasses }}" data-panel-nav="true">
              <button
                type="button"
                class="{{ dateNavButtonClasses }}"
                data-panel-nav-prev="true"
                aria-label="Previous month"
              >
                {{ renderIcon({
                    name: navigation.prevIcon,
                    datas: options.iconDatas
                }) }}
              </button>

              {# Month labels centered #}
              <div class="flex gap-60 flex-1 justify-center">
                {% if dateRange.month %}
                  <span class="{{ dateMonthClasses }}" data-panel-month="true">
                    {{ dateRange.month }}
                  </span>
                {% elif dateRange.startMonth %}
                  <span class="{{ dateMonthClasses }}" data-panel-month="true">
                    {{ dateRange.startMonth }}
                  </span>
                  <span class="{{ dateMonthClasses }}" data-panel-month="true">
                    {{ dateRange.endMonth }}
                  </span>
                {% endif %}
              </div>

              <button
                type="button"
                class="{{ dateNavButtonClasses }}"
                data-panel-nav-next="true"
                aria-label="Next month"
              >
                {{ renderIcon({
                    name: navigation.nextIcon,
                    datas: options.iconDatas
                }) }}
              </button>
            </div>
          {% endif %}

          {# Calendar grid(s) #}
          <div class="{% if variant == 'double' %}flex gap-[var(--spacing-inset-small)]{% endif %}">
            {# First calendar - November 2025 #}
            <div
              class="{{ calendarClasses }}"
              data-panel-calendar="true"
            >
              {# Days header #}
              <div class="{{ calendarHeaderClasses }}">
                <div class="{{ calendarDayHeaderClasses }}">SU</div>
                <div class="{{ calendarDayHeaderClasses }}">MO</div>
                <div class="{{ calendarDayHeaderClasses }}">TU</div>
                <div class="{{ calendarDayHeaderClasses }}">WE</div>
                <div class="{{ calendarDayHeaderClasses }}">TH</div>
                <div class="{{ calendarDayHeaderClasses }}">FR</div>
                <div class="{{ calendarDayHeaderClasses }}">SA</div>
              </div>

              {# Dates grid - November 2025 starts on Saturday #}
              <div class="{{ calendarGridClasses }}">
                {# Previous month days (October 26-31) #}
                {% for day in range(26, 32) %}
                  <button
                    type="button"
                    class="{{ calendarDateOutsideClasses }}"
                    data-panel-date="prev-{{ day }}"
                  >
                    {{ day }}
                  </button>
                {% endfor %}

                {# Current month days (November 1-30) #}
                {% for day in range(1, 31) %}
                  <button
                    type="button"
                    class="{{ calendarDateClasses }} {% if day == 27 %}{{ calendarDateSelectedClasses }}{% endif %}"
                    data-panel-date="{{ day }}"
                  >
                    {{ day }}
                  </button>
                {% endfor %}

                {# Next month days (December 1-6) to complete grid #}
                {% for day in range(1, 7) %}
                  <button
                    type="button"
                    class="{{ calendarDateOutsideClasses }}"
                    data-panel-date="next-{{ day }}"
                  >
                    {{ day }}
                  </button>
                {% endfor %}
              </div>
            </div>

            {# Second calendar - December 2025 (only for double variant) #}
            {% if variant == 'double' %}
              <div
                class="{{ calendarClasses }}"
                data-panel-calendar="true"
              >
                {# Days header #}
                <div class="{{ calendarHeaderClasses }}">
                  <div class="{{ calendarDayHeaderClasses }}">SU</div>
                  <div class="{{ calendarDayHeaderClasses }}">MO</div>
                  <div class="{{ calendarDayHeaderClasses }}">TU</div>
                  <div class="{{ calendarDayHeaderClasses }}">WE</div>
                  <div class="{{ calendarDayHeaderClasses }}">TH</div>
                  <div class="{{ calendarDayHeaderClasses }}">FR</div>
                  <div class="{{ calendarDayHeaderClasses }}">SA</div>
                </div>

                {# Dates grid - December 2025 starts on Monday #}
                <div class="{{ calendarGridClasses }}">
                  {# Previous month day (November 30) #}
                  <button
                    type="button"
                    class="{{ calendarDateOutsideClasses }}"
                    data-panel-date="prev-30"
                  >
                    30
                  </button>

                  {# Current month days (December 1-31) #}
                  {% for day in range(1, 32) %}
                    <button
                      type="button"
                      class="{{ calendarDateClasses }} {% if day == 5 %}{{ calendarDateSelectedClasses }}{% endif %}"
                      data-panel-date="{{ day }}"
                    >
                      {{ day }}
                    </button>
                  {% endfor %}

                  {# Next month days (January 1-3) to complete grid #}
                  {% for day in range(1, 4) %}
                    <button
                      type="button"
                      class="{{ calendarDateOutsideClasses }}"
                      data-panel-date="next-{{ day }}"
                    >
                      {{ day }}
                    </button>
                  {% endfor %}
                </div>
              </div>
            {% endif %}
          </div>

        {# List-item type panels #}
        {% elif panelType == "list-item" %}
          {% for item in items %}
            <div
              class="{{ itemClasses }}"
              data-panel-item="true"
              data-panel-item-type="{{ item.type }}"
              role="option"
              tabindex="0"
            >
              {# Checkbox type - checkbox gère son propre label #}
              {% if item.type == "checkbox" and item.checkboxName and options.checkboxDatas %}
                {{ renderCheckbox({
                    id: item.checkboxName,
                    datas: options.checkboxDatas
                }) }}

              {# Label-icon type #}
              {% elif item.type == "label-icon" and item.iconName and options.iconDatas %}
                <div class="{{ iconWrapperClasses }}">
                  {{ renderIcon({
                      name: item.iconName,
                      datas: options.iconDatas
                  }) }}
                </div>
                <span class="{{ textClasses }}">{{ item.text }}</span>

              {# Simple label type #}
              {% elif item.type == "label" %}
                <span class="{{ textClasses }}">{{ item.text }}</span>
              {% endif %}
            </div>
          {% endfor %}
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
