{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Toggle                                           │
   │ Toggle switches with label and description support      │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.id (string): Toggle identifier
    - options.datas (array): Toggle configuration data

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/toggle.njk" import renderToggle %}

    {{ renderToggle({
        id: "demoToggle1",
        datas: atoms.toggle.toggles
    }) }}

  @created 2025-01-15
#}

{% macro renderToggle(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.id %}
    <span class="error" role="alert">Error: Missing required prop (id)</span>
  {% else %}
    {# Find toggle using universal filter #}
    {% set toggleData = options.datas | findByName(options.id) %}

    {% if not toggleData %}
      <span class="error" role="alert">Toggle not found: {{ options.id }}</span>
    {% else %}
      {{ renderSingleToggle(toggleData) }}
    {% endif %}
  {% endif %}
{% endmacro %}

{% macro renderSingleToggle(toggle) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    2. Compute Final Values
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% set switchData = toggle.switch | default({}) %}
  {% set switchValue = switchData.value | default(toggle.id) %}
  {% set isChecked = switchData.checked | default(false) %}
  {% set isDisabled = switchData.disabled | default(false) %}
  {% set hasLabel = toggle.label %}
  {% set hasDescription = toggle.description %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    3. Tailwind Classes
    Index:
    3.1 Label Wrapper Classes
    3.2 Input Wrapper Classes
    3.3 Input Classes
    3.4 Track Classes
    3.5 Off Indicator Classes
    3.6 On Indicator Classes
    3.7 Text Wrapper Classes
    3.8 Label Classes
    3.9 Description Classes
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

  {# --------------------------
      3.1 Label Wrapper Classes
      Description: Layout, spacing, positioning, cursor
  -------------------------- #}
  {% set labelWrapperClasses = "inline-flex items-start gap-[var(--spacing-ui-default)] py-[var(--spacing-ui-default)] cursor-pointer relative group" %}

  {# --------------------------
      3.2 Input Wrapper Classes
      Description: Layout, positioning
  -------------------------- #}
  {% set toggleWrapperClasses = "relative flex items-start" %}

  {# --------------------------
      3.3 Input Classes
      Description: Screen reader only positioning
  -------------------------- #}
  {% set inputClasses = "sr-only peer" %}

  {# --------------------------
      3.4 Track Classes
      Description: Layout, positioning, sizing, borders, colors, effects, states
  -------------------------- #}
  {% set trackClasses = "relative inline-flex h-6 w-11 items-center rounded-full border-2 border-[var(--color-form)] bg-transparent transition-all peer-hover:border-[var(--color-form-hover)] peer-checked:border-[var(--color-form-control-checked)] peer-checked:bg-[var(--color-form-control-checked)] peer-checked:peer-hover:border-[var(--color-form-control-checked)] peer-checked:peer-hover:brightness-110 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-[var(--color-semantic-information-focus)] peer-focus:ring-offset-2 peer-disabled:opacity-50 peer-disabled:cursor-not-allowed after:content-[''] after:absolute after:left-[var(--spacing-micro-minimal)] after:top-1/2 after:-translate-y-1/2 after:h-4 after:w-4 after:rounded-full after:bg-[var(--color-form)] after:transition-all peer-hover:after:bg-[var(--color-form-hover)] peer-checked:after:translate-x-[1.125rem] peer-checked:after:bg-white peer-checked:peer-hover:after:bg-white" %}

  {# --------------------------
      3.5 Off Indicator Classes
      Description: Positioning, sizing, borders, effects, states
  -------------------------- #}
  {% set offIndicatorClasses = "absolute left-[1.5rem] top-1/2 h-1.5 w-1.5 -translate-y-1/2 rounded-full border border-[var(--color-form)] transition-opacity peer-checked:opacity-0 pointer-events-none" %}

  {# --------------------------
      3.6 On Indicator Classes
      Description: Positioning, sizing, borders, colors, effects, states
  -------------------------- #}
  {% set onIndicatorClasses = "absolute left-[0.7rem] top-1/2 h-2.5 w-0.5 -translate-y-1/2 rounded-full bg-white opacity-0 transition-opacity peer-checked:opacity-100 pointer-events-none" %}

  {# --------------------------
      3.7 Text Wrapper Classes
      Description: Layout
  -------------------------- #}
  {% set textContainerClasses = "flex flex-col" %}

  {# --------------------------
      3.8 Label Classes
      Description: Typography, colors, states
  -------------------------- #}
  {% set labelTextClasses = "text-body text-[var(--color-form)] group-hover:text-[var(--color-form-hover)] select-none transition-colors" %}

  {# --------------------------
      3.9 Description Classes
      Description: Spacing, typography, colors
  -------------------------- #}
  {% set descriptionClasses = "mt-[var(--spacing-ui-minimal] text-helper text-[var(--color-global-contrast-light-02)]" %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    4. Render HTML
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  <label
    for="{{ toggle.id }}"
    class="{{ labelWrapperClasses }}"
    data-toggle-label
  >
    <div class="{{ toggleWrapperClasses }}">
      <input
        type="checkbox"
        role="switch"
        id="{{ toggle.id }}"
        name="{{ toggle.id }}"
        value="{{ switchValue }}"
        class="{{ inputClasses }}"
        data-toggle-id="{{ toggle.id }}"
        data-toggle-type="toggle"
        aria-checked="{% if isChecked %}true{% else %}false{% endif %}"
        {% if isChecked %}checked{% endif %}
        {% if isDisabled %}disabled{% endif %}
        {% if toggle.ariaLabel %}aria-label="{{ toggle.ariaLabel }}"{% endif %}
        {% if hasDescription %}aria-describedby="{{ toggle.id }}-description"{% endif %}
      />

      <div class="{{ trackClasses }}" data-toggle-container></div>

      <span class="{{ offIndicatorClasses }}"></span>
      <span class="{{ onIndicatorClasses }}"></span>
    </div>

    {% if hasLabel or hasDescription %}
      <div class="{{ textContainerClasses }}">
        {% if hasLabel %}
          <span class="{{ labelTextClasses }}">{{ toggle.label }}</span>
        {% endif %}

        {% if hasDescription %}
          <p id="{{ toggle.id }}-description" class="{{ descriptionClasses }}">
            {{ toggle.description }}
          </p>
        {% endif %}
      </div>
    {% endif %}
  </label>
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
