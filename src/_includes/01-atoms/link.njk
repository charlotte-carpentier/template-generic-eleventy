{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Link                                             │
   │ Navigation links with semantic attributes               │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/link.njk" import renderLink %}

    Basic link:
    {{ renderLink({
        name: "demoLink1",
        datas: atoms.link.links,
        iconDatas: atoms.icon.icons,
        tooltipDatas: atoms.tooltip.tooltips
    }) }}

  @created 2025-09-15
#}

{% from "01-atoms/icon.njk" import renderIcon %}
{% from "01-atoms/tooltip.njk" import renderTooltip %}

{% macro renderLink(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find link using universal filter #}
    {% set linkData = options.datas | findByName(options.name) %}

    {# Render link or error message #}
    {% if not linkData %}
      <span class="error" role="alert">Link not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set finalAriaLabel = options.ariaLabel | default(linkData.ariaLabel) %}
      {% set finalAriaDescribedby = options.ariaDescribedby | default(linkData.ariaDescribedby) %}
      {% set isDisabled = options.disabled | default(linkData.disabled) | default(false) %}
      {% set isActive = options.active | default(false) %}
      {% set hasIcon = linkData.iconName %}
      {% set tooltipName = finalAriaDescribedby | replace('tooltip-', '') if finalAriaDescribedby else '' %}
      {% set hasTooltip = tooltipName != finalAriaDescribedby and tooltipName != '' %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Base Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Base Classes
          Description: Layout, typography, colors, effects, focus, states
      -------------------------- #}
      {% set baseClasses = "touch-target inline-flex items-center gap-[var(--spacing-micro-default)] font-medium text-body text-[var(--color-form)] underline decoration-1 underline-offset-2 transition-all hover:text-[var(--color-form-hover)] hover:no-underline active:text-[var(--color-form-active)] active:no-underline focus:outline-none focus:border-2 focus:border-[var(--color-semantic-information-focus)] focus:rounded-[var(--radius-default)] focus:px-[var(--spacing-ui-minimal)] focus:py-[var(--spacing-ui-minimal)] focus:-m-[var(--spacing-micro-default)] [aria-disabled='true']:opacity-50 [aria-disabled='true']:cursor-not-allowed [aria-disabled='true']:pointer-events-none" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <a
        href="{{ linkData.href }}"
        class="{{ baseClasses }}"
        data-link-name="{{ linkData.name }}"
        data-link-type="link"
        {% if linkData.target %}target="{{ linkData.target }}"{% endif %}
        {% if linkData.rel %}rel="{{ linkData.rel }}"{% endif %}
        {% if linkData.download %}download{% endif %}
        {% if linkData.onclick %}onclick="{{ linkData.onclick | escape }}"{% endif %}
        {% if finalAriaLabel %}aria-label="{{ finalAriaLabel }}"{% endif %}
        {% if finalAriaDescribedby %}aria-describedby="{{ finalAriaDescribedby }}"{% endif %}
        {% if isDisabled %}aria-disabled="true"{% endif %}
        {% if isActive %}data-link-active="true"{% endif %}
        {% if options.role %}role="{{ options.role }}"{% endif %}
        {% if options.ariaSelected is defined %}aria-selected="{{ options.ariaSelected }}"{% endif %}
      >
        {# Icon (for social links) #}
        {% if hasIcon and options.iconDatas %}
          {{ renderIcon({
              name: linkData.iconName,
              datas: options.iconDatas
          }) }}
        {% endif %}

        {# Link text #}
        {{ linkData.text }}
      </a>

      {# Auto-render tooltip if defined #}
      {% if hasTooltip and options.tooltipDatas %}
        {{ renderTooltip({
            name: tooltipName,
            datas: options.tooltipDatas
        }) }}
      {% endif %}

    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
