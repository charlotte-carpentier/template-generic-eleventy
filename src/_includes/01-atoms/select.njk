{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Select                                           │
   │ Dropdown select inputs with size variants and states    │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Select identifier
    - options.datas (array): Select configuration data
    - options.disabled (boolean): Override disabled state
    - options.ariaLabel (string): Override aria-label
    - options.iconDatas (object): Icon atom data for chevron

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/select.njk" import renderSelect %}

    {{ renderSelect({
        name: "demoSelect1",
        datas: atoms.select.selects,
        iconDatas: atoms.icon.icons
    }) }}

  @created 2025-09-15
  @updated 2025-10-26
#}

{% from "01-atoms/icon.njk" import renderIcon %}

{% macro renderSelect(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find select using universal filter #}
    {% set selectData = options.datas | findByName(options.name) %}

    {# Render select or error message #}
    {% if not selectData %}
      <span class="error" role="alert">Select not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set isDisabled = options.disabled | default(selectData.disabled) | default(false) %}
      {% set finalAriaLabel = options.ariaLabel | default(selectData.ariaLabel) %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Wrapper Classes
        3.2 Base Select Classes
        3.3 State Classes
        3.4 Size Classes
        3.5 Icon Wrapper Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Wrapper Classes
          Description: Layout, positioning, sizing
      -------------------------- #}
      {% set wrapperClasses = "relative inline-block w-full" %}

      {# --------------------------
          3.2 Base Select Classes
          Description: Layout, sizing, appearance, borders, cursor, focus
      -------------------------- #}
      {% set baseSelectClasses = "block w-full appearance-none rounded-[var(--radius-default)] transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-[var(--color-form-active)] focus:ring-offset-2" %}

      {# --------------------------
          3.3 State Classes
          Description: Colors, background, borders, hover, disabled states
      -------------------------- #}
      {% set stateClasses = "bg-white border border-[var(--color-form)] text-[var(--color-global-default)] hover:border-[var(--color-form-hover)] disabled:bg-[var(--color-global-contrast-light-04)] disabled:opacity-50 disabled:cursor-not-allowed" %}

      {# --------------------------
          3.4 Size Classes
          Description: Height, spacing, typography
      -------------------------- #}
      {% set sizeClasses = 'h-12 px-[var(--spacing-ui-default)] py-[var(--spacing-ui-minimal)] pr-[var(--spacing-ui-maximal)] text-body leading-5' %}

      {# --------------------------
          3.5 Icon Wrapper Classes
          Description: Positioning, colors
      -------------------------- #}
      {% set iconWrapperClasses = "absolute top-1/2 right-[var(--spacing-ui-default)] -translate-y-1/2 pointer-events-none text-[var(--color-global-default)]" %}

      {# --------------------------
          3.6 Fallback Icon Classes
          Description: Sizing, fill
      --------------------------- #}
      {% set fallbackIconClasses = "w-3 h-3 fill-current" %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      <div class="{{ wrapperClasses }}">
        <select
          id="{{ selectData.id }}"
          name="{{ selectData.name }}"
          class="{{ baseSelectClasses }} {{ stateClasses }} {{ sizeClasses }}"
          data-select-name="{{ selectData.name }}"
          data-select-type="select"
          data-select-size="default"
          {% if isDisabled %}disabled{% endif %}
          {% if finalAriaLabel %}aria-label="{{ finalAriaLabel }}"{% endif %}
        >
          {% if selectData.options %}
            {% for opt in selectData.options %}
              <option
                value="{{ opt.value }}"
                {% if opt.selected %}selected{% endif %}
              >
                {{ opt.label }}
              </option>
            {% endfor %}
          {% endif %}
        </select>

        {# Chevron icon #}
        <div class="{{ iconWrapperClasses }}" aria-hidden="true">
          {% if options.iconDatas %}
            {{ renderIcon({
                name: "demoSortDown1",
                datas: options.iconDatas
            }) }}
          {% else %}
            <svg class="{{ fallbackIconClasses }}" viewBox="0 0 12 12" aria-hidden="true">
              <path d="M6 9L1.5 3h9L6 9z"/>
            </svg>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
