{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Select                                           │
   │ Dropdown select inputs with variants and states         │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Select identifier
    - options.datas (array): Select configuration data
    - options.disabled (boolean): Override disabled state
    - options.ariaLabel (string): Override aria-label
    - options.iconDatas (object): Icon atom data for chevron

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/select.njk" import renderSelect %}

    {{ renderSelect({
        name: "demoSelect1",
        datas: atoms.select.selects,
        iconDatas: atoms.icon.icons
    }) }}

  @created 2025-01-15
  @updated 2025-10-26
#}

{% from "01-atoms/icon.njk" import renderIcon %}

{% macro renderSelect(options) %}
  {# Validate required props #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find select using universal filter #}
    {% set selectData = options.datas | findByName(options.name) %}

    {# Render select or error message #}
    {% if not selectData %}
      <span class="error" role="alert">Select not found: {{ options.name }}</span>
    {% else %}
      {# Compute final values #}
      {% set isDisabled = options.disabled | default(selectData.disabled) | default(false) %}
      {% set finalAriaLabel = options.ariaLabel | default(selectData.ariaLabel) %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         CSS Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# Wrapper classes #}
      {% set wrapperClasses = "relative inline-block w-full" %}

      {# Base classes - Common to all selects #}
      {% set baseClasses = "block w-full appearance-none bg-white border border-[var(--color-form)] rounded-[var(--radius-input)] text-[var(--color-global-default)] transition-colors cursor-pointer hover:border-[var(--color-form-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--color-form-active)] focus:ring-offset-0 disabled:bg-[var(--color-global-contrast-light-04)] disabled:opacity-50 disabled:cursor-not-allowed" %}

      {# Size variants #}
      {% set sizeClasses = "" %}
      {% if selectData.variants and 'small' in selectData.variants %}
        {% set sizeClasses = "h-10 px-3 py-2 pr-8 text-sm leading-5" %}
      {% else %}
        {% set sizeClasses = "h-12 px-4 py-3 pr-9 text-base leading-5" %}
      {% endif %}

      {# Icon wrapper classes #}
      {% set iconWrapperClasses = "absolute top-1/2 right-3 -translate-y-1/2 pointer-events-none text-[var(--color-global-default)]" %}

      {# Render select with wrapper #}
      <div class="{{ wrapperClasses }}">
        <select
          name="{{ selectData.name }}"
          class="{{ baseClasses }} {{ sizeClasses }}"
          data-select-name="{{ selectData.name }}"
          data-select-type="select"
          {% if isDisabled %}disabled{% endif %}
          {% if finalAriaLabel %}aria-label="{{ finalAriaLabel }}"{% endif %}
        >
          {% if selectData.options %}
            {% for opt in selectData.options %}
              <option
                value="{{ opt.value }}"
                {% if opt.selected %}selected{% endif %}
              >
                {{ opt.label }}
              </option>
            {% endfor %}
          {% endif %}
        </select>

        {# Chevron icon #}
        <div class="{{ iconWrapperClasses }}" aria-hidden="true">
          {% if options.iconDatas %}
            {{ renderIcon({
                name: "demoSortDown1",
                datas: options.iconDatas
            }) }}
          {% else %}
            <svg class="w-3 h-3 fill-current" viewBox="0 0 12 12" aria-hidden="true">
              <path d="M6 9L1.5 3h9L6 9z"/>
            </svg>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
Charlotte Carpentier · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}