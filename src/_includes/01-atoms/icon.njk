{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Icon                                             │
   │ SVG icons with size variants and styling                │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Icon identifier
    - options.datas (object): Icon configuration data (nested by category)
    - options.class (string): Additional CSS classes (e.g. "icon-duotone" for dual-color styling)
    - options.fillColor (string): Optional fill color class (e.g. "fill-red-500" or "fill-[var(--color-button-primary)]")

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/icon.njk" import renderIcon %}

    {{ renderIcon({
        name: "demoSmile1",
        datas: atoms.icon.icons
    }) }}

    {{ renderIcon({
        name: "demoFileUp1",
        datas: atoms.icon.icons,
        class: "icon-duotone"
    }) }}

  Country Flags:
    Country flags use the flag-icons library (loaded via CDN in base.njk).
    When spriteId contains a 2-letter country code (e.g., "us", "fr", "de"),
    the component renders a <span class="fi fi-xx"> instead of an SVG sprite.

  @created 2025-01-15
#}

{% macro renderIcon(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find icon using universal filter - handles nested categories automatically #}
    {% set iconData = options.datas | findByName(options.name) %}

    {# Render icon or error message #}
    {% if not iconData %}
      <span class="error" role="alert">Icon not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set spriteId = iconData.spriteId | default(options.name) %}
      {% set iconAlt = iconData.alt | default('Icon') %}
      {% set iconSize = iconData.size | default('md') %}
      {% set isCountryFlag = spriteId | length == 2 %}
      {% set fillColorClass = options.fillColor | default("fill-current") %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Size Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Size Classes
          Description: Sizing based on size prop
      --------------------------- #}
      {% set sizeMap = {
        'xs': 'w-3 h-3',
        'sm': 'w-4 h-4',
        'md': 'w-5 h-5',
        'lg': 'w-6 h-6',
        'xl': 'w-8 h-8',
        'xxl': 'w-10 h-10'
      } %}
      {% set sizeClasses = sizeMap[iconSize] or sizeMap['md'] %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% if isCountryFlag %}
        {# --------------------------
            4.1 Base Classes (Flag)
            Description: Layout
        -------------------------- #}
        {% set flagClasses = "fi fi-" ~ spriteId ~ " inline-block flex-shrink-0 " ~ sizeClasses %}
        {% if options.class %}
          {% set flagClasses = flagClasses ~ ' ' ~ options.class %}
        {% endif %}

        <span
          class="{{ flagClasses }}"
          role="img"
          aria-label="{{ iconAlt }}"
          title="{{ iconAlt }}"
          data-icon-name="{{ iconData.name }}"
          data-icon-type="flag"
          {% if iconData.size %}data-icon-size="{{ iconData.size }}"{% endif %}
        ></span>

      {% else %}
        {# --------------------------
            4.2 Base Classes (Icon)
            Description: Layout, colors
        -------------------------- #}
        {% set baseClasses = "inline-block flex-shrink-0" %}

        {% set finalClasses = baseClasses ~ ' ' ~ sizeClasses ~ ' ' ~ fillColorClass %}
        {% if options.class %}
          {% set finalClasses = finalClasses ~ ' ' ~ options.class %}
        {% endif %}

        <svg
          class="{{ finalClasses }}"
          aria-label="{{ iconAlt }}"
          role="img"
          data-icon-name="{{ iconData.name }}"
          data-icon-type="icon"
          {% if iconData.size %}data-icon-size="{{ iconData.size }}"{% endif %}
        >
          <use href="/assets/icons/sprites/sprite.svg#{{ spriteId }}"></use>
        </svg>
      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
