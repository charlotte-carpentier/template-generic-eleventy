{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Heading                                          │
   │ Semantic text content with variant styling              │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Heading identifier
    - options.datas (array): Heading configuration data
    - options.tag (string): Override HTML tag (h1-h6, p, span, small)

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/heading.njk" import renderHeading %}

    {{ renderHeading({
        name: "demoHead1",
        datas: atoms.heading.headings
    }) }}

  @created 2025-01-15
#}

{% macro renderHeading(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find heading using universal filter #}
    {% set headingData = options.datas | findByName(options.name) %}

    {# Render heading or error message #}
    {% if not headingData %}
      <span class="error" role="alert">Heading not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set finalTag = options.tag | default(headingData.tag) | default('p') %}

      {# Security: Add rel="noopener noreferrer" to external links with target="_blank" #}
      {% set secureContent = headingData.text %}
      {% if 'target="_blank"' in secureContent and 'rel=' not in secureContent %}
        {% set secureContent = secureContent | replace('target="_blank"', 'target="_blank" rel="noopener noreferrer"') %}
      {% endif %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Base Classes
        3.2 Typography Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Base Classes
          Description: Colors
      -------------------------- #}
      {% set baseClasses = "text-[var(--color-global-heading)]" %}

      {# --------------------------
          3.2 Typography Classes
          Description: Typography based on tag + variant combination
      --------------------------- #}
      {% set variant = headingData.variant | default('sans') %}

      {% set typographyMap = {
        'h1-serif': 'typography-h1-serif',
        'h1-sans': 'typography-h1',
        'h2-serif': 'typography-h2-serif',
        'h2-sans': 'typography-h2',
        'h3-serif': 'typography-h3-serif',
        'h3-sans': 'typography-h3',
        'h4-serif': 'typography-h4-serif',
        'h4-sans': 'typography-h4',
        'h5-serif': 'typography-h5-serif',
        'h5-sans': 'typography-h5',
        'h6-serif': 'typography-h6-serif',
        'h6-sans': 'typography-h6',
        'small': 'typography-body-small',
        'span': 'typography-body-regular',
        'p': 'typography-body-regular'
      } %}

      {% if finalTag in ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'] %}
        {% set lookupKey = finalTag ~ '-' ~ variant %}
      {% else %}
        {% set lookupKey = finalTag %}
      {% endif %}

      {% set typographyClasses = typographyMap[lookupKey] or typographyMap['p'] %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% if finalTag == 'h1' %}
        <h1
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h1"
        >{{ secureContent | safe }}</h1>
      {% elif finalTag == 'h2' %}
        <h2
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h2"
        >{{ secureContent | safe }}</h2>
      {% elif finalTag == 'h3' %}
        <h3
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h3"
        >{{ secureContent | safe }}</h3>
      {% elif finalTag == 'h4' %}
        <h4
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h4"
        >{{ secureContent | safe }}</h4>
      {% elif finalTag == 'h5' %}
        <h5
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h5"
        >{{ secureContent | safe }}</h5>
      {% elif finalTag == 'h6' %}
        <h6
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h6"
        >{{ secureContent | safe }}</h6>
      {% elif finalTag == 'span' %}
        <span
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="span"
        >{{ secureContent | safe }}</span>
      {% elif finalTag == 'small' %}
        <small
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="small"
        >{{ secureContent | safe }}</small>
      {% else %}
        <p
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="p"
        >{{ secureContent | safe }}</p>
      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
