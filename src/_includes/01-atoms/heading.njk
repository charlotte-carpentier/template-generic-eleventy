{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Heading                                          │
   │ Semantic text content with variant styling              │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/heading.njk" import renderHeading %}
    
    {{ renderHeading({ 
        name: "page_title",
        datas: atoms.heading.texts
    }) }}
  
  Props:
    - option.name (string): Heading identifier
    - option.datas (array): Heading configuration data
    - option.tag (string): Override HTML tag (h1-h6, p, span, small)
  
  Notes:
    - Uses existing text classes from input.css
    - Automatically adds security attributes to external links
    - Supports inline HTML content with safe filter
  
  Security:
    - Adds rel="noopener noreferrer" to external links with target="_blank"
  
  @created 2025-01-15
#}

{% macro renderHeading(option) %}
  {# Check if datas is provided #}
  {% if not option.datas %}
    <span>Error: No heading configuration provided</span>
  {% else %}
    {# Retrieve heading configuration #}
    {% set headingConfig = option.datas %}
    {% set headingName = option.name %}
    
    {# Find the specific heading by name #}
    {% set headingData = null %}
    {% for heading in headingConfig %}
      {% if heading.name == headingName %}
        {% set headingData = heading %}
      {% endif %}
    {% endfor %}

    {# Fallback if heading not found #}
    {% if not headingData %}
      <span>Heading not found: {{ headingName }}</span>
    {% else %}
      {# Build CSS classes #}
      {% set tag = option.tag | default(headingData.tag) | default('') %}
      {% set variant = headingData.variant | default('') %}
      {% set cssClasses = 'text-' ~ variant %}
      
      {# Security: Add rel="noopener noreferrer" to external links with target="_blank" #}
      {% set secureContent = headingData.text %}
      {% if 'target="_blank"' in secureContent and 'rel=' not in secureContent %}
        {% set secureContent = secureContent | replace('target="_blank"', 'target="_blank" rel="noopener noreferrer"') %}
      {% endif %}
      
      {# Render the heading with specified tag #}
      {% if tag == 'h1' %}
        <h1 class="{{ cssClasses }}">{{ secureContent | safe }}</h1>
      {% elif tag == 'h2' %}
        <h2 class="{{ cssClasses }}">{{ secureContent | safe }}</h2>
      {% elif tag == 'h3' %}
        <h3 class="{{ cssClasses }}">{{ secureContent | safe }}</h3>
      {% elif tag == 'h4' %}
        <h4 class="{{ cssClasses }}">{{ secureContent | safe }}</h4>
      {% elif tag == 'h5' %}
        <h5 class="{{ cssClasses }}">{{ secureContent | safe }}</h5>
      {% elif tag == 'h6' %}
        <h6 class="{{ cssClasses }}">{{ secureContent | safe }}</h6>
      {% elif tag == 'span' %}
        <span class="{{ cssClasses }}">{{ secureContent | safe }}</span>
      {% elif tag == 'small' %}
        <small class="{{ cssClasses }}">{{ secureContent | safe }}</small>
      {% else %}
        <p class="{{ cssClasses }}">{{ secureContent | safe }}</p>
      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}


{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
Charlotte Carpentier · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}