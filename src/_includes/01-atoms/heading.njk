{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Heading                                          │
   │ Semantic text content with variant styling              │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Heading identifier
    - options.datas (array): Heading configuration data
    - options.tag (string): Override HTML tag (h1-h6, p, span, small)

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/heading.njk" import renderHeading %}

    {{ renderHeading({
        name: "demoHead1",
        datas: atoms.heading.headings
    }) }}

  @created 2025-01-15
#}

{% macro renderHeading(options) %}
  {# Validate required props #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find heading using universal filter #}
    {% set headingData = options.datas | findByName(options.name) %}

    {# Render heading or error message #}
    {% if not headingData %}
      <span class="error" role="alert">Heading not found: {{ options.name }}</span>
    {% else %}
      {# Compute final tag with fallback cascade #}
      {% set finalTag = options.tag | default(headingData.tag) | default('p') %}

      {# Security: Add rel="noopener noreferrer" to external links with target="_blank" #}
      {% set secureContent = headingData.text %}
      {% if 'target="_blank"' in secureContent and 'rel=' not in secureContent %}
        {% set secureContent = secureContent | replace('target="_blank"', 'target="_blank" rel="noopener noreferrer"') %}
      {% endif %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         CSS Classes - Typography Tokens
      ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# Base classes - Common to all headings #}
      {% set baseClasses = "text-[var(--color-global-heading)]" %}

      {# Typography classes - Uses design tokens from input.css
         Each heading level has predefined font/weight/line-height #}
      {% set typographyClasses = "" %}
      
      {% if finalTag == 'h1' %}
        {% set typographyClasses = "text-4xl font-bold leading-tight" %}
      {% elif finalTag == 'h2' %}
        {% set typographyClasses = "text-3xl font-semibold leading-snug" %}
      {% elif finalTag == 'h3' %}
        {% set typographyClasses = "text-2xl font-semibold leading-snug" %}
      {% elif finalTag == 'h4' %}
        {% set typographyClasses = "text-xl font-medium leading-normal" %}
      {% elif finalTag == 'h5' %}
        {% set typographyClasses = "text-lg font-medium leading-normal" %}
      {% elif finalTag == 'h6' %}
        {% set typographyClasses = "text-base font-medium leading-normal" %}
      {% elif finalTag == 'small' %}
        {% set typographyClasses = "text-sm font-normal leading-normal" %}
      {% elif finalTag == 'span' or finalTag == 'p' %}
        {% set typographyClasses = "text-base font-normal leading-normal" %}
      {% endif %}

      {# Render heading element #}
      {% if finalTag == 'h1' %}
        <h1
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h1"
        >{{ secureContent | safe }}</h1>
      {% elif finalTag == 'h2' %}
        <h2
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h2"
        >{{ secureContent | safe }}</h2>
      {% elif finalTag == 'h3' %}
        <h3
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h3"
        >{{ secureContent | safe }}</h3>
      {% elif finalTag == 'h4' %}
        <h4
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h4"
        >{{ secureContent | safe }}</h4>
      {% elif finalTag == 'h5' %}
        <h5
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h5"
        >{{ secureContent | safe }}</h5>
      {% elif finalTag == 'h6' %}
        <h6
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="h6"
        >{{ secureContent | safe }}</h6>
      {% elif finalTag == 'span' %}
        <span
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="span"
        >{{ secureContent | safe }}</span>
      {% elif finalTag == 'small' %}
        <small
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="small"
        >{{ secureContent | safe }}</small>
      {% else %}
        <p
          class="{{ baseClasses }} {{ typographyClasses }}"
          data-heading-name="{{ headingData.name }}"
          data-heading-type="heading"
          data-heading-tag="p"
        >{{ secureContent | safe }}</p>
      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
Charlotte Carpentier · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}