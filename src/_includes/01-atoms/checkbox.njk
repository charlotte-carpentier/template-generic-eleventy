{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Checkbox                                         │
   │ Accessible checkbox inputs with labels                  │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.id (string): Checkbox identifier
    - options.datas (array): Checkbox configuration data

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/checkbox.njk" import renderCheckbox %}

    {{ renderCheckbox({
       id: "demoCheck1",
       datas: atoms.checkbox.checkboxes
    }) }}

  @created 2025-01-15
#}

{% macro renderCheckbox(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.id %}
    <span class="error" role="alert">Error: Missing required prop (id)</span>
  {% else %}
    {# Find checkbox using universal filter #}
    {% set targetCheckbox = options.datas | findByName(options.id) %}

    {# Render or show error #}
    {% if targetCheckbox %}
      {{ renderSingleCheckbox(targetCheckbox) }}
    {% else %}
      <span class="error" role="alert">Checkbox not found: {{ options.id }}</span>
    {% endif %}
  {% endif %}
{% endmacro %}

{% macro renderSingleCheckbox(checkbox) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    2. Compute Final Values
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% set boxData = checkbox.box | default({}) %}
  {% set isChecked = boxData.checked | default(false) %}
  {% set isDisabled = boxData.disabled | default(false) %}
  {% set isRequired = boxData.required | default(false) %}
  {% set checkboxValue = boxData.value | default(checkbox.id) %}
  {% set finalAriaLabel = checkbox.ariaLabel | default(checkbox.label) %}
  {% set hasDescription = checkbox.description %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    3. Tailwind Classes
    Index:
    3.1 Label Wrapper Classes
    3.2 Input Wrapper Classes
    3.3 Input Classes
    3.4 Checkmark Classes
    3.5 Text Container Classes
    3.6 Label Text Classes
    3.7 Description Classes
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

  {# --------------------------
      3.1 Label Wrapper Classes
      Description: Layout, spacing, states
  -------------------------- #}
  {% set labelClasses = "inline-flex items-start gap-2 cursor-pointer group" %}

  {# --------------------------
      3.2 Input Wrapper Classes
      Description: Layout, positioning
  -------------------------- #}
  {% set inputWrapperClasses = "relative flex items-center" %}

  {# --------------------------
      3.3 Input Classes
      Description: Sizing, borders, colors, effects, states
  -------------------------- #}
  {% set inputClasses = "peer h-5 w-5 cursor-pointer appearance-none rounded border-2 transition-all border-[var(--color-form)] hover:border-[var(--color-form-hover)] checked:bg-[var(--color-form-control-checked)] checked:border-[var(--color-form-control-checked)] focus:outline-none focus:ring-2 focus:ring-[var(--color-semantic-information-focus)] disabled:opacity-50 disabled:cursor-not-allowed" %}

  {# --------------------------
      3.4 Checkmark Classes
      Description: Positioning, effects, states
  -------------------------- #}
  {% set checkmarkClasses = "absolute text-white opacity-0 pointer-events-none top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 peer-checked:opacity-100 transition-opacity" %}

  {# --------------------------
      3.5 Text Container Classes
      Description: Layout
  -------------------------- #}
  {% set textContainerClasses = "flex flex-col" %}

  {# --------------------------
      3.6 Label Text Classes
      Description: Typography, colors, states
  -------------------------- #}
  {% set labelTextClasses = "text-base text-[var(--color-form)] group-hover:text-[var(--color-form-hover)] select-none transition-colors" %}

  {# --------------------------
      3.7 Description Classes
      Description: Typography, colors
  -------------------------- #}
  {% set descriptionClasses = "mt-0.5 text-sm text-[var(--color-global-contrast-light-02)]" %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    4. Render HTML
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  <label
    for="{{ checkbox.id }}"
    class="{{ labelClasses }}"
    data-checkbox-label
  >
    <div class="{{ inputWrapperClasses }}">
      <input
        type="checkbox"
        id="{{ checkbox.id }}"
        name="{{ checkbox.id }}"
        value="{{ checkboxValue }}"
        class="{{ inputClasses }}"
        data-checkbox-id="{{ checkbox.id }}"
        data-checkbox-type="checkbox"
        {% if isChecked %}checked{% endif %}
        {% if isDisabled %}disabled{% endif %}
        {% if isRequired %}required{% endif %}
        {% if finalAriaLabel %}aria-label="{{ finalAriaLabel }}"{% endif %}
        {% if hasDescription %}aria-describedby="{{ checkbox.id }}-description"{% endif %}
      />

      {# Checkmark SVG - Simple checkmark, centered in 16x16 viewBox #}
      <span class="{{ checkmarkClasses }}">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none" class="w-3 h-3">
          <path d="M3 8L6 11L13 4" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </span>
    </div>

    <div class="{{ textContainerClasses }}">
      <span class="{{ labelTextClasses }}">
        {{ checkbox.label }}
        {% if isRequired %}
          <span aria-hidden="true">*</span>
          <span class="sr-only">(required)</span>
        {% endif %}
      </span>

      {% if hasDescription %}
        <p id="{{ checkbox.id }}-description" class="{{ descriptionClasses }}">
          {{ checkbox.description }}
        </p>
      {% endif %}
    </div>
  </label>
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
