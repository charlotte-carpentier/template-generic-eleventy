{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Image                                            │
   │ Responsive images with variant styling                  │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Image identifier
    - options.datas (array): Image configuration data
    - options.iconDatas (array): Icon data (for avatar variants with icons)

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/image.njk" import renderImage %}

    {{ renderImage({
        name: "demoImage1",
        datas: atoms.image.images,
        iconDatas: atoms.icon.icons
    }) }}

  @created 2025-01-15
#}

{% from "01-atoms/icon.njk" import renderIcon %}

{% macro renderImage(options) %}
  {# Validate required props #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find image using universal filter #}
    {% set imageData = options.datas | findByName(options.name) %}

    {# Render image or error message #}
    {% if not imageData %}
      <span class="error" role="alert">Image not found: {{ options.name }}</span>
    {% else %}
      {# Compute final values with fallback cascade #}
      {% set imageSrc = imageData.src | default('') %}
      {% set imageAlt = imageData.alt | default('') %}
      {% set imageVariant = imageData.variant | default('') %}
      {% set hasIcon = imageData.iconName %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
         CSS Classes - Tailwind Utilities
      ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# Base classes - Common to all images #}
      {% set baseClasses = "block max-w-full h-auto object-cover" %}

      {# Variant classes - Visual style mapping #}
      {% set variantClasses = "" %}
      
      {% if imageVariant == 'avatar' %}
        {% set variantClasses = "w-11 h-11 rounded-[var(--radius-6)]" %}
      
      {% elif imageVariant == 'square' %}
        {% set variantClasses = "w-full max-w-2xl aspect-square" %}
      
      {% elif imageVariant == 'landscape' %}
        {% set variantClasses = "w-80" %}
      
      {% elif imageVariant == 'wide' %}
        {% set variantClasses = "w-64" %}
      
      {% else %}
        {% set variantClasses = "w-full" %}
      {% endif %}

      {# Render based on variant type #}
      {% if imageVariant == 'avatar' %}
        {% if hasIcon %}
          <div
            class="inline-flex items-center justify-center w-11 h-11 rounded-[var(--radius-6)] bg-[var(--color-global-contrast-light-04)]"
            data-image-name="{{ imageData.name }}"
            data-image-type="avatar-icon"
            role="img"
            aria-label="{{ imageAlt }}"
          >
            {% if options.iconDatas %}
              {{ renderIcon({ 
                  name: imageData.iconName, 
                  datas: options.iconDatas 
              }) }}
            {% endif %}
          </div>
        {% else %}
          <img
            src="{{ imageSrc }}"
            alt="{{ imageAlt }}"
            class="{{ baseClasses }} {{ variantClasses }}"
            loading="lazy"
            decoding="async"
            data-image-name="{{ imageData.name }}"
            data-image-type="avatar-photo"
          />
        {% endif %}
      {% else %}
        <img
          src="{{ imageSrc }}"
          alt="{{ imageAlt }}"
          class="{{ baseClasses }} {{ variantClasses }}"
          loading="lazy"
          decoding="async"
          data-image-name="{{ imageData.name }}"
          data-image-type="image"
        />
      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
Charlotte Carpentier · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}