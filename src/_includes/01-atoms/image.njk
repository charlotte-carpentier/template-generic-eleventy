{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Image                                            │
   │ Responsive images with automated metadata generation    │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Image identifier
    - options.datas (array): Image configuration data
    - options.iconDatas (array): Icon data (for avatar variants with icons)

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/image.njk" import renderImage %}

    {{ renderImage({
        name: "demoImage1",
        datas: atoms.image.images,
        iconDatas: atoms.icon.icons
    }) }}

  Note: Metadata (width, height, srcset, sizes) auto-generated via bin/generate-image-metadata.js

  @created 2025-01-15
  @updated 2026-01-15
#}

{% from "01-atoms/icon.njk" import renderIcon %}

{% macro renderImage(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find image using universal filter #}
    {% set imageData = options.datas | findByName(options.name) %}

    {# Render image or error message #}
    {% if not imageData %}
      <span class="error" role="alert">Image not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set imageSrc = imageData.src | default('') %}
      {% set imageAlt = imageData.alt | default('') %}
      {% set imageVariant = imageData.variant | default('default') %}
      {% set imageWidth = imageData.width %}
      {% set imageHeight = imageData.height %}
      {% set imageSrcset = imageData.srcset | default('') %}
      {% set imageSizes = imageData.sizes | default('(max-width: 768px) 100vw, 800px') %}
      {% set hasIcon = imageData.iconName %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Base Classes
        3.2 Variant Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Base Classes
          Description: Responsive by default (MDN standard)
      -------------------------- #}
      {% set baseClasses = "block max-w-full h-auto object-cover" %}

      {# --------------------------
          3.2 Variant Classes
          Description: Avatar (fixed UI element) or Default (fluid responsive)
      --------------------------- #}
      {% set variantMap = {
        'avatar': 'w-11 h-11 rounded-[var(--radius-default)]',
        'default': 'w-full'
      } %}
      {% set variantClasses = variantMap[imageVariant] or variantMap['default'] %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% if imageVariant == 'avatar' %}
        {% if hasIcon %}
          {# Avatar with icon #}
          <div
            class="inline-flex items-center justify-center w-11 h-11 rounded-[var(--radius-default)] bg-[var(--color-global-contrast-light-04)]"
            data-image-name="{{ imageData.name }}"
            data-image-type="avatar-icon"
            role="img"
            aria-label="{{ imageAlt }}"
          >
            {% if options.iconDatas %}
              {{ renderIcon({
                  name: imageData.iconName,
                  datas: options.iconDatas
              }) }}
            {% endif %}
          </div>
        {% else %}
          {# Avatar photo (fixed 44x44px) #}
          <img
            src="{{ imageSrc }}"
            alt="{{ imageAlt }}"
            width="44"
            height="44"
            class="{{ baseClasses }} {{ variantClasses }}"
            loading="lazy"
            decoding="async"
            data-image-name="{{ imageData.name }}"
            data-image-type="avatar-photo"
          />
        {% endif %}
      {% else %}
        {# Default responsive image - Native HTML with auto-generated metadata #}
        <img
          src="{{ imageSrc }}"
          alt="{{ imageAlt }}"
          {% if imageWidth %}width="{{ imageWidth }}"{% endif %}
          {% if imageHeight %}height="{{ imageHeight }}"{% endif %}
          {% if imageSrcset %}srcset="{{ imageSrcset }}"{% endif %}
          sizes="{{ imageSizes }}"
          class="{{ baseClasses }} {{ variantClasses }}"
          loading="lazy"
          decoding="async"
          data-image-name="{{ imageData.name }}"
          data-image-type="default"
        />
      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
