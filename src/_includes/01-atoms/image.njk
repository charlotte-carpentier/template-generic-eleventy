{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Image                                            │
   │ Responsive images with variant styling                  │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - option.name (string): Image identifier
    - option.datas (array): Image configuration data
  
  Usage:
    {% from "01-atoms/image.njk" import renderImage %}
    
    {{ renderImage({ 
        name: "profile_photo",
        datas: atoms.image.images
    }) }}
  
  Notes:
    - Silent fallback if image not found (no error display)
    - Supports lazy loading and async decoding
    - Flexible variant handling from data structure
    - Includes width/height attributes for better performance
  
  @created 2025-01-15
#}

{% macro renderImage(option) %}
  {# Check if datas is provided #}
  {% if not option.datas %}
    <!-- Fallback silencieux : pas d'affichage d'erreur -->
  {% else %}
    {# Retrieve image configuration #}
    {% set imagesConfig = option.datas %}
    {% set imageName = option.name %}
    
    {# Find the specific image by name - stop loop when found #}
    {% set imageData = null %}
    {% set found = false %}
    {% for image in imagesConfig %}
      {% if image.name == imageName and not found %}
        {% set imageData = image %}
        {% set found = true %}
      {% endif %}
    {% endfor %}

    {# Render only if image found - silent fallback #}
    {% if imageData %}
      {# Build CSS classes #}
      {% set variant = imageData.variant | default('') %}
      {% set cssClasses = 'image-' ~ variant %}
      
      {# Variant-specific classes moved to data structure if needed #}
      {% if variant == '' %}
        {% set cssClasses = cssClasses %}
      {% endif %}
      
      {# Render the image #}
      <img 
        src="{{ imageData.src }}" 
        alt="{{ imageData.alt }}" 
        class="{{ cssClasses }}"
        loading="lazy"
        decoding="async"
        {% if imageData.width %}width="{{ imageData.width }}"{% endif %}
        {% if imageData.height %}height="{{ imageData.height }}"{% endif %}
      />
    {% endif %}
  {% endif %}
{% endmacro %}

{#
============================
Summon HAT Components Wisely
============================

May your bugs be forever exiled to the shadow realm. ✦
#}