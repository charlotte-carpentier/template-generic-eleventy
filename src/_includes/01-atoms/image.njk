{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Image                                            │
   │ Responsive images with variant styling                  │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.name (string): Image identifier
    - options.datas (array): Image configuration data
    - options.iconDatas (array): Icon data (for avatar variants with icons)

  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/image.njk" import renderImage %}

    {{ renderImage({
        name: "demoImage1",
        datas: atoms.image.images,
        iconDatas: atoms.icon.icons
    }) }}

  @created 2025-01-15
#}

{% from "01-atoms/icon.njk" import renderIcon %}

{% macro renderImage(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find image using universal filter #}
    {% set imageData = options.datas | findByName(options.name) %}

    {# Render image or error message #}
    {% if not imageData %}
      <span class="error" role="alert">Image not found: {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set imageSrc = imageData.src | default('') %}
      {% set imageAlt = imageData.alt | default('') %}
      {% set imageVariant = imageData.variant | default('') %}
      {% set hasIcon = imageData.iconName %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Base Classes
        3.2 Variant Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}

      {# --------------------------
          3.1 Base Classes
          Description: Layout, sizing
      -------------------------- #}
      {% set baseClasses = "block max-w-full h-auto object-cover" %}

      {# --------------------------
          3.2 Variant Classes
          Description: Sizing, aspect ratio, borders per variant
      --------------------------- #}
      {% set variantMap = {
        'avatar': 'w-11 h-11 rounded-[var(--radius-default)]',
        'square': 'w-full max-w-2xl aspect-square',
        'landscape': 'w-80',
        'wide': 'w-64'
      } %}
      {% set variantClasses = variantMap[imageVariant] or 'w-full' %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% if imageVariant == 'avatar' %}
        {% if hasIcon %}
          <div
            class="inline-flex items-center justify-center w-11 h-11 rounded-[var(--radius-default)] bg-[var(--color-global-contrast-light-04)]"
            data-image-name="{{ imageData.name }}"
            data-image-type="avatar-icon"
            role="img"
            aria-label="{{ imageAlt }}"
          >
            {% if options.iconDatas %}
              {{ renderIcon({
                  name: imageData.iconName,
                  datas: options.iconDatas
              }) }}
            {% endif %}
          </div>
        {% else %}
          <img
            src="{{ imageSrc }}"
            alt="{{ imageAlt }}"
            class="{{ baseClasses }} {{ variantClasses }}"
            loading="lazy"
            decoding="async"
            data-image-name="{{ imageData.name }}"
            data-image-type="avatar-photo"
          />
        {% endif %}
      {% else %}
        <img
          src="{{ imageSrc }}"
          alt="{{ imageAlt }}"
          class="{{ baseClasses }} {{ variantClasses }}"
          loading="lazy"
          decoding="async"
          data-image-name="{{ imageData.name }}"
          data-image-type="image"
        />
      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2025
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
