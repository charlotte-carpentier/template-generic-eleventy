{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Switch                                           │
   │ Toggle controls with consistent styling                 │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - options.id (string): Switch identifier for single rendering
    - options.group (boolean): Render as group if true
    - options.groupLabel (string): Group label text
    - options.groupSrOnly (boolean): Hide group label visually
    - options.datas (object): Switch configuration data
  
  Usage:
    {% from "01-atoms/switch.njk" import renderSwitch %}
    
    Single switch:
    {{ renderSwitch({ id: "torch", datas: atoms.switchs }) }}
    
    Group of switches:
    {{ renderSwitch({ 
        group: true, 
        groupLabel: "Settings",
        datas: atoms.switchs 
    }) }}
  
  Features:
    - Supports single or group rendering
    - Size variants (from data configuration)
    - State-based styling (default, checked, disabled, disabledChecked)
    - Fieldset/legend for semantic grouping
  
  Accessibility:
    - Checkbox input type for native toggle behavior
    - aria-label support for screen readers
    - Screen-reader-only labels option
    - Proper disabled state handling
  
  @created 2025-01-15
#}

{% macro renderSwitch(options) %}
  {# Initialize default values for styling classes #}
  {% set globalStyle = options.datas.globalStyle | default('') %}
  {% set fieldsetClasses = options.datas.fieldsetClasses | default('') %}
  {% set legendClasses = options.datas.legendClasses | default('') %}
  {% set groupContainerClasses = options.datas.groupContainerClasses | default('') %}
  
  {# Check if rendering as a group or individual switch #}
  {% if options.group %}
    <fieldset class="{{ fieldsetClasses }}">
      {% if options.groupLabel %}
        <legend class="{{ legendClasses }} {% if options.groupSrOnly %}sr-only{% endif %}">
          {{ options.groupLabel }}
        </legend>
      {% endif %}
      
      <div class="{{ groupContainerClasses }}">
        {% for switch in options.datas.switchs %}
          {{ renderSingleSwitch(switch, options.datas) }}
        {% endfor %}
      </div>
    </fieldset>
  {% else %}
    {# Initialize switchData as null before searching #}
    {% set switchData = null %}
    
    {# Find the switch matching the requested ID in the data collection #}
    {% for switch in options.datas.switchs %}
      {% if switch.id == options.id %}
        {% set switchData = switch %}
      {% endif %}
    {% endfor %}
    
    {# Render switch if data was found, otherwise show error #}
    {% if switchData %}
      {{ renderSingleSwitch(switchData, options.datas) }}
    {% else %}
      <span class="{{ options.datas.errorClasses | default('') }}">Switch not found: {{ options.id }}</span>
    {% endif %}
  {% endif %}
{% endmacro %}

{% macro renderSingleSwitch(switch, datas) %}
  {# Determine variant and size, set defaults if not specified #}
  {% set variant = switch.variant | default('default') %}
  {% set size = switch.size | default('') %}
  
  {# Determine additional state classes based on switch state #}
  {% if switch.disabled and switch.checked %}
    {% set variant = 'disabledChecked' %}
  {% elseif switch.disabled %}
    {% set variant = 'disabled' %}
  {% elseif switch.checked %}
    {% set variant = 'checked' %}
  {% endif %}
  
  {# Retrieve specific classes for the selected variant #}
  {% set switchBaseClasses = datas.variants.container[variant].base %}
  {% set switchFocusClasses = datas.variants.container[variant].focus %}
  
  {# Retrieve thumb classes for the current variant #}
  {% set thumbBaseClasses = datas.variants.thumb[variant].base | default('') %}
  
  {# Get size classes from the data #}
  {% set containerSizeClasses = datas.variants.sizes[size].container %}
  {% set thumbSizeClasses = datas.variants.sizes[size].thumb %}
  
  <div>
    <label>
      <input 
        type="checkbox" 
        id="{{ switch.id }}" 
        name="{{ switch.id }}"
        value="{{ switch.value }}"
        class=""
        {% if switch.checked %}checked{% endif %}
        {% if switch.disabled %}disabled{% endif %}
        {% if switch.ariaLabel %}aria-label="{{ switch.ariaLabel }}"{% endif %}
      />
      <div 
        class="{{ containerSizeClasses }} {{ switchBaseClasses }} {{ switchFocusClasses }}"
      >
        <div 
          class="{{ thumbSizeClasses }} {{ thumbBaseClasses }}"
        ></div>
      </div>
    </label>
  </div>
{% endmacro %}

{#
============================
Summon HAT Components Wisely
============================

Adding a new switch to switchs.json:
{
  "switchs": [
    {
      "id": "unique_id",
      "value": "submission_value",
      "checked": true,
      "disabled": false,
      "variant": "default",
      "size": "medium",
      "ariaLabel": "Accessible description"
    }
  ]
}

May your bugs be forever exiled to the shadow realm. ✦
#}