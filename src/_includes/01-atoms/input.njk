{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Input                                            │
   │ Form input fields with validation and states            │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Props:
    - option.name (string): Input identifier
    - option.datas (array): Input configuration data
    - option.disabled (boolean): Override disabled state
  
  Usage:
    {% from "01-atoms/input.njk" import renderInput %}
    
    {{ renderInput({ 
        name: "username",
        datas: atoms.input.inputs
    }) }}
  
  Supported Types:
    - text, email, tel, password (standard inputs)
    - textarea (multi-line text with character counter)
  
  Features:
    - Label with required indicator
    - Pattern validation with help text
    - Error message containers with ARIA
    - Character counter for textarea
    - Accessible disabled states
  
  Accessibility:
    - Proper label/input association
    - aria-describedby for help text and errors
    - role="alert" for error messages
    - Required field indicators
  
  @created 2025-01-15
#}

{% macro renderInput(option) %}
  {# Check if datas is provided #}
  {% if not option.datas %}
    <span>Error: No input configuration provided</span>
  {% else %}
    {# Retrieve input configuration #}
    {% set inputsConfig = option.datas %}
    {% set inputName = option.name %}
    
    {# Find the specific input by name #}
    {% set inputData = null %}
    {% for input in inputsConfig %}
      {% if input.name == inputName %}
        {% set inputData = input %}
      {% endif %}
    {% endfor %}

    {# Fallback if input not found #}
    {% if not inputData %}
      <span>Input not found: {{ inputName }}</span>
    {% else %}
      {# Input container #}
      <div class="">
        {# Label #}
        {% if inputData.label %}
          <label for="{{ inputData.id }}" class="">
            {{ inputData.label }}
            {% if inputData.required %}<span>*</span>{% endif %}
          </label>
        {% endif %}
        
        {# Text Input #}
        {% if inputData.type in ['text', 'email', 'tel', 'password'] %}
          <input 
            type="{{ inputData.type }}"
            id="{{ inputData.id }}"
            name="{{ inputData.name or inputData.id }}"
            class=""
            placeholder="{{ inputData.placeholder }}"
            {% if inputData.required %}required{% endif %}
            {% if inputData.maxLength %}maxlength="{{ inputData.maxLength }}"{% endif %}
            {% if inputData.pattern %}pattern="{{ inputData.pattern }}"{% endif %}
            {% if option.disabled %}disabled{% endif %}
            aria-describedby="{% if inputData.patternMessage %}{{ inputData.id }}-help{% endif %} {% if inputData.errorMessage %}{{ inputData.id }}-error{% endif %}"
          />
        
        {# Textarea #}
        {% elif inputData.type === 'textarea' %}
          <textarea 
            id="{{ inputData.id }}"
            name="{{ inputData.name or inputData.id }}"
            class="input-base"
            placeholder="{{ inputData.placeholder }}"
            rows="{{ inputData.rows or 3 }}"
            {% if inputData.required %}required{% endif %}
            {% if inputData.maxLength %}maxlength="{{ inputData.maxLength }}"{% endif %}
            {% if option.disabled %}disabled{% endif %}
            aria-describedby="{% if inputData.maxLength %}{{ inputData.id }}-count{% endif %} {% if inputData.errorMessage %}{{ inputData.id }}-error{% endif %}"
          ></textarea>
          
          {# Character counter for textarea #}
          {% if inputData.maxLength %}
            <div id="{{ inputData.id }}-count" class="">
              0/{{ inputData.maxLength }}
            </div>
          {% endif %}
        {% endif %}
        
        {# Help text #}
        {% if inputData.patternMessage %}
          <div id="{{ inputData.id }}-help" class="">
            {{ inputData.patternMessage }}
          </div>
        {% endif %}
        
        {# Error message container #}
        {% if inputData.errorMessage %}
          <div id="{{ inputData.id }}-error" role="alert">
            {{ inputData.errorMessage }}
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{#
============================
Summon HAT Components Wisely
============================

May your bugs be forever exiled to the shadow realm. ✦
#}