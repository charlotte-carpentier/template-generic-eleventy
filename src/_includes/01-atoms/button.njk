{# ┌─────────────────────────────────────────────────────────┐
   │ ATOM › Button                                           │
   │ Interactive button with variants and states             │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    {% from "01-atoms/button.njk" import renderButton %}

    Basic button:
    {{ renderButton({
        name: "demoButton1",
        datas: atoms.button.buttons,
        url: dynamicUrl,
        iconDatas: atoms.icon.icons,
        tooltipDatas: atoms.tooltip.tooltips
    }) }}

    Error page button with specific styling:
    {{ renderButton({
        name: "button-reveal-all",
        datas: atoms.button.buttons,
        url: buttonUrl,
        iconDatas: atoms.icon.icons,
        tooltipDatas: atoms.tooltip.tooltips,
        isErrorPage: true
    }) }}

  @created 2025-09-15
#}

{% from "01-atoms/icon.njk" import renderIcon %}
{% from "01-atoms/tooltip.njk" import renderTooltip %}

{% macro renderButton(options) %}

  {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. Validate Props
  ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
  {% if not options.datas %}
    <span class="error" role="alert">Error: Missing required prop (datas)</span>
  {% elif not options.name %}
    <span class="error" role="alert">Error: Missing required prop (name)</span>
  {% else %}
    {# Find button using universal filter #}
    {% set buttonData = options.datas | findByName(options.name) %}

    {# Render button or error message #}
    {% if not buttonData %}
      <span class="error" role="alert">Button not found:
        {{ options.name }}</span>
    {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        2. Compute Final Values
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {% set buttonUrl = options.url | default(buttonData.url) | default('') %}
      {% set isLink = buttonUrl != '' %}
      {% set buttonType = options.type | default(buttonData.type) | default('button') %}
      {% set buttonSize = buttonData.size | default('medium') %}
      {% set buttonVariant = buttonData.variant | default('primary') %}
      {% set isDisabled = options.disabled or buttonData.disabled %}
      {% set finalAriaLabel = options.ariaLabel | default(buttonData.ariaLabel) %}
      {% set finalAriaDescribedby = options.ariaDescribedby | default(buttonData.ariaDescribedby) %}

      {# Check if button has icon #}
      {% set hasIcon = buttonData.iconName %}
      {% set iconPosition = buttonData.iconPosition | default('left') %}
      {% set tooltipName = finalAriaDescribedby | replace('tooltip-', '') if finalAriaDescribedby else '' %}
      {% set hasTooltip = tooltipName != finalAriaDescribedby and tooltipName != '' %}

      {# A11y validation: Icon-only buttons require aria-label #}
      {% if iconPosition == 'center' and not finalAriaLabel %}
        <span class="error" role="alert">Icon-only button requires aria-label: {{ options.name }}</span>
      {% else %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        3. Tailwind Classes
        Index:
        3.1 Base Classes
        3.2 Size Classes
        3.3 Variant Classes
        3.4 Icon Classes
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {# --------------------------
          3.1 Base Classes
          Description: Layout, typography, borders, transition, focus, cursor
        --------------------------#}
      {% set baseClasses = "touch-target inline-flex items-center justify-center font-medium rounded-[var(--radius-default)] transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-[var(--color-semantic-information-focus)] focus:ring-offset-2 disabled:cursor-not-allowed" %}

      {# --------------------------
        3.2 Size Classes
        Description: Padding, text size, minimum target size (WCAG 2.5.8)
        --------------------------#}
      {% set sizeMap = {
        'small': 'px-[var(--spacing-ui-default)] py-[var(--spacing-ui-minimal)] text-body',
        'medium': 'px-[var(--spacing-ui-comfortable)] py-[var(--spacing-ui-default)] text-body'
      } %}
      {% set sizeClasses = sizeMap[buttonSize] or sizeMap['medium'] %}

      {# --------------------------
        3.3 Variant Classes
        Description: Color, background, border, hover/active/disabled
        --------------------------#}
      {% set variantMap = {
        'primary': 'bg-[var(--color-button-primary)] text-white hover:bg-[var(--color-button-primary-hover)] active:bg-[var(--color-button-primary-hover)] disabled:opacity-50',
        'secondary': 'bg-transparent text-[var(--color-button-secondary)] border-2 border-[var(--color-button-secondary)] hover:bg-[var(--color-button-secondary-hover-light)] active:bg-[var(--color-button-secondary-hover-light)] disabled:opacity-50',
        'ghost': 'bg-transparent text-[var(--color-global-default)] hover:bg-[var(--color-global-contrast-light-04)] active:bg-[var(--color-global-contrast-light-03)] disabled:opacity-50',
        'icon': 'bg-transparent text-[var(--color-global-default)] hover:bg-[var(--color-global-contrast-light-04)] active:bg-[var(--color-global-contrast-light-04)] disabled:opacity-50',
        'fixed': 'bg-[var(--color-global-contrast-light-04)] text-[var(--color-global-default)] hover:bg-[var(--color-global-contrast-light-03)] active:bg-[var(--color-global-contrast-light-03)] disabled:opacity-50'
      } %}
      {% set variantClasses = variantMap[buttonVariant] or variantMap['primary'] %}

      {# --------------------------
        3.4 Icon Classes
        Description: Gap between icon and text
        --------------------------#}
      {% if hasIcon and iconPosition != 'center' %}
        {% set iconClasses = 'gap-[var(--spacing-ui-minimal)]' %}
      {% else %}
        {% set iconClasses = '' %}
      {% endif %}

      {# ━━━━━━━━━━━━━━━━━━━━━━━━━━
        4. Render HTML
      ━━━━━━━━━━━━━━━━━━━━━━━━━ #}
      {# Conditional rendering: <a> for navigation, <button> for actions #}
      {% if isLink %}

        <a href="{{ buttonUrl }}"
          class="{{ baseClasses }} {{ sizeClasses }} {{ variantClasses }} {{ iconClasses }}"
          data-button-name="{{ buttonData.name }}"
          data-button-type="link"
          {% if hasIcon %}data-button-icon-position="{{ iconPosition }}"{% endif %}
          {% if options.id %}id="{{ options.id }}"{% endif %}
          {% if finalAriaLabel %}aria-label="{{ finalAriaLabel }}"{% endif %}
          {% if hasTooltip and options.tooltipDatas %}aria-describedby="{{ finalAriaDescribedby }}"{% endif %}>
      {% else %}
        <button
          type="{{ buttonType }}"
          class="{{ baseClasses }} {{ sizeClasses }} {{ variantClasses }} {{ iconClasses }}"
          data-button-name="{{ buttonData.name }}"
          data-button-type="button"
          {% if hasIcon %}data-button-icon-position="{{ iconPosition }}"{% endif %}
          {% if isDisabled %}disabled{% endif %}
          {% if options.onclick %}onclick="{{ options.onclick | escape }}"{% endif %}
          {% if options.id %}id="{{ options.id }}"{% endif %}
          {% if finalAriaLabel %}aria-label="{{ finalAriaLabel }}"{% endif %}
          {% if hasTooltip and options.tooltipDatas %}aria-describedby="{{ finalAriaDescribedby }}"{% endif %}>
      {% endif %}

        {# Icon left position #}
        {% if hasIcon and (iconPosition == 'left' or iconPosition == 'both') %}
          {% if options.iconDatas %}
            {{ renderIcon({
                name: buttonData.iconName,
                datas: options.iconDatas,
                decorative: true
            }) }}
          {% endif %}
        {% endif %}

        {# Icon center position (icon-only button) #}
        {% if hasIcon and iconPosition == 'center' %}
          {% if options.iconDatas %}
            {{ renderIcon({
                name: buttonData.iconName,
                datas: options.iconDatas,
                decorative: true
            }) }}
          {% endif %}
        {% endif %}

        {# Button text (skip for icon-only buttons) #}
        {% if iconPosition != 'center' %}
          {{ buttonData.text }}
        {% endif %}

        {# Icon right position #}
        {% if hasIcon and (iconPosition == 'right' or iconPosition == 'both') %}
          {% if options.iconDatas %}
            {{ renderIcon({
                name: buttonData.iconName,
                datas: options.iconDatas,
                decorative: true
            }) }}
          {% endif %}
        {% endif %}

      {# Close tag matches opening tag #}
      {% if isLink %}
        </a>
      {% else %}
        </button>
      {% endif %}

      {# Auto-render tooltip if defined #}
      {% if hasTooltip and options.tooltipDatas %}
        {{ renderTooltip({
            name: tooltipName,
            datas: options.tooltipDatas
        }) }}
      {% endif %}

      {% endif %}
    {% endif %}
  {% endif %}
{% endmacro %}

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
