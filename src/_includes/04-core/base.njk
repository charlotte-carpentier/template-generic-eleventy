{# ┌─────────────────────────────────────────────────────────┐
   │ LAYOUT › Base                                           │
   │ Main HTML layout with SEO, analytics and integrations   │
   └─────────────────────────────────────────────────────────┘ #}

{#
  Usage — Summon HAT Components Wisely:
    ---
    layout: base.njk
    title: "My Page Title"
    description: "My page description"
    ---

  Props:
    - title (string): Page title override
    - description (string): Page description override
    - favicon (object): Custom favicon paths
    - hideHeaderFooter (boolean): Hide header/footer for special pages

  Features:
    - Complete SEO metadata (Open Graph, Twitter Cards)
    - Favicon support (PNG, ICO, SVG, Apple Touch)
    - Google Fonts integration with preconnect
    - Critical images preload for LCP optimization
    - Icon sprite preload
    - Flag icons library (flag-icons via CDN)
    - Cookie consent (Axeptio) with Google Consent Mode v2
    - Google Analytics 4 integration
    - Netlify Identity redirect for Decap CMS
    - Conditional header/footer rendering
    - Semantic HTML5 structure
    - Screen reader optimizations
    - Optimized JavaScript loading (ES modules with conditional imports)

  Accessibility:
    - Semantic HTML5 structure (<header>, <main>, <footer>)
    - Screen reader only content (.sr-only) for SEO
    - Proper lang attribute
    - Skip to content patterns via semantic markup
    - ARIA landmarks via organism components

  Configuration:
    Configure in src/_data/site.json:
    - site.language: HTML lang attribute
    - site.title: Default site title
    - site.description: Default description
    - site.url: Canonical URL base
    - site.socialImage: OG/Twitter card image
    - site.fonts.google: Google Fonts URL
    - site.fonts.preconnect: Enable fonts preconnect
    - site.preloadImages: Array of critical images
    - site.iconLibrary.fontAwesome: Enable Font Awesome
    - site.themeColor: Browser theme color
    - site.cookieConsent.provider: "axeptio"
    - site.cookieConsent.clientId: Axeptio client ID
    - site.cookieConsent.cookiesVersion: Axeptio version
    - site.analytics.ga4: GA4 measurement ID

  @created 2025-01-15
  @updated 2026-02-03 - Migrated inline scripts to external files (CSP security)
#}

<!DOCTYPE html>
<html lang="{{ site.language | default('fr') }}">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    {# ----- Basic SEO ----- #}
    <title>{{ title | default(site.title) }}</title>
    <meta name="description" content="{{ description | default(site.description) }}">
    <meta name="robots" content="{{ robots | default('index, follow') }}">
    <link rel="canonical" href="{{ site.url }}{{ page.url | url }}">

    {# ----- Author (for articles) ----- #}
    {% if author %}
      <meta name="author" content="{{ author }}">
    {% endif %}

    {# ----- Favicons ----- #}
    <link rel="icon" type="image/png" sizes="16x16" href="{{ favicon.png16 | default('/assets/icons/favicon/favicon-16x16.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ favicon.png32 | default('/assets/icons/favicon/favicon-32x32.png') }}">
    <link rel="shortcut icon" href="{{ favicon.ico | default('/assets/icons/favicon/favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ favicon.appleTouch | default('/assets/icons/favicon/apple-touch-icon.png') }}">
    {% if favicon.svg %}
      <link rel="icon" href="{{ favicon.svg }}" type="image/svg+xml">
    {% endif %}

    {# ----- Open Graph ----- #}
    <meta property="og:type" content="{{ type | default('website') }}">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:title" content="{{ title | default(site.title) }}">
    <meta property="og:description" content="{{ description | default(site.description) }}">
    <meta property="og:image" content="{{ site.url }}{{ socialImage | default(site.socialImage) }}">
    <meta property="og:image:alt" content="{{ socialImageAlt | default(title) }}">
    <meta property="og:site_name" content="{{ site.title }}">
    <meta property="og:locale" content="{{ site.locale | default('fr_FR') }}">

    {# ----- Article-specific OG tags ----- #}
    {% if type === 'article' %}
      <meta property="article:published_time" content="{{ date | date('iso') }}">
      {% if updated %}
        <meta property="article:modified_time" content="{{ updated | date('iso') }}">
      {% endif %}
      {% if author %}
        <meta property="article:author" content="{{ author }}">
      {% endif %}
      {% if tags %}
        {% for tag in tags %}
          <meta property="article:tag" content="{{ tag }}">
        {% endfor %}
      {% endif %}
    {% endif %}

    {# ----- Twitter Card ----- #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ site.url }}{{ page.url }}">
    <meta name="twitter:title" content="{{ title | default(site.title) }}">
    <meta name="twitter:description" content="{{ description | default(site.description) }}">
    <meta name="twitter:image" content="{{ site.url }}{{ socialImage | default(site.socialImage) }}">
    <meta name="twitter:image:alt" content="{{ socialImageAlt | default(title) }}">
    {% if site.twitterHandle %}
      <meta name="twitter:site" content="{{ site.twitterHandle }}">
    {% endif %}

    {# ----- JSON-LD for Articles ----- #}
    {% if type === 'article' %}
      <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "{{ title }}",
        "description": "{{ description }}",
        "image": "{{ site.url }}{{ socialImage | default(site.socialImage) }}",
        "datePublished": "{{ date | date('iso') }}"{% if updated %},
        "dateModified": "{{ updated | date('iso') }}"{% endif %},
        "author": {
          "@type": "Person",
          "name": "{{ author | default(site.author) }}"
        },
        "publisher": {
          "@type": "Organization",
          "name": "{{ site.title }}",
          "logo": {
            "@type": "ImageObject",
            "url": "{{ site.url }}/assets/images/logo.png"
          }
        },
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "{{ site.url }}{{ page.url }}"
        }
      }
      </script>
    {% endif %}

    {# ----- Fonts ----- #}
    {% if site.fonts.preconnect %}
      <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="anonymous"/>
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/>
    {% endif %}
    {% if site.fonts.google %}
      <link href="{{ site.fonts.google }}" rel="stylesheet"/>
    {% endif %}

    {# ----- Image preload (optional) ----- #}
    {% if site.preloadImages %}
      {% for image in site.preloadImages %}
        <link rel="preload" as="image" href="{{ image }}">
      {% endfor %}
    {% endif %}

    {# ----- Icon sprite preload ----- #}
    <link rel="preload" href="/assets/icons/sprites/sprite.svg" as="image" type="image/svg+xml">

    {# ----- Stylesheets ----- #}
    <link rel="stylesheet" href="/output.css"/>

    {# ----- Flag Icons Library (CDN) ----- #}
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css"
      integrity="sha384-8olrmTcwXL3OYMeB+2ok8jx9/U/FZxeLnoRWdu1Pyi+lakrkqoI7hfysfQF5Q1Xx"
      crossorigin="anonymous"/>

    {% if site.iconLibrary.fontAwesome %}
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
    {% endif %}

    {# ----- Manifest and theme color ----- #}
    <link rel="manifest" href="/site.webmanifest"/>
    <meta name="theme-color" content="{{ site.themeColor | default('#ffffff') }}"/>

    {# ----- Cookie Consent (Axeptio) ----- #}
    {% if site.cookieConsent.provider === "axeptio" and site.cookieConsent.clientId %}
      <script src="/assets/scripts/core/axeptio.js"
        data-client-id="{{ site.cookieConsent.clientId }}"
        data-cookies-version="{{ site.cookieConsent.cookiesVersion }}">
      </script>
    {% endif %}

    {# ----- Google Analytics 4 ----- #}
    {% if site.analytics.ga4 %}
      <script async="async" src="https://www.googletagmanager.com/gtag/js?id={{ site.analytics.ga4 }}"></script>
      <script src="/assets/scripts/core/analytics.js"
        data-measurement-id="{{ site.analytics.ga4 }}">
      </script>
    {% endif %}
  </head>

  <body class="min-h-screen flex flex-col">

  {# Skip link - WCAG 2.4.1 Bypass Blocks #}

  <a href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-[var(--spacing-ui-default)] focus:py-[var(--spacing-ui-minimal)] focus:bg-[var(--color-global-white)] focus:text-[var(--color-global-default)] focus:rounded-[var(--radius-default)] focus:shadow-[var(--elevation-floating)]"
  >
    Passer au contenu principal
  </a>

  {# ----- Header Organism ----- #}
  {% if not hideHeaderFooter %}
    {% from "03-organisms/header.njk" import renderHeader %}
    {{ renderHeader({
      name: "demoHeader1",
      datas: organisms.header.headers,
      vectorDatas: atoms.vector.vectors,
      iconDatas: atoms.icon.icons,
      navigationDatas: organisms.navigation.navigations,
      linkDatas: atoms.link.links
    }) }}
  {% endif %}

  {# ----- Main content ----- #}
  <main id="main-content" class="flex-1">
    {# Add hidden site description on homepage for SEO #}
    {% if page.url === '/' %}
      <section class="sr-only">
        <p>{{ site.description }}</p>
      </section>
    {% endif %}
    {{ content | safe }}
  </main>

  {# ----- Footer Organism ----- #}
  {% if not hideHeaderFooter %}
    {% from "03-organisms/footer.njk" import renderFooter %}
    {{ renderFooter({
        name: "demoFooter1",
        datas: organisms.footer.footers,
        headingDatas: atoms.heading.headings,
        linkDatas: atoms.link.links,
        vectorDatas: atoms.vector.vectors,
        navSecondaryDatas: organisms["navigation-secondary"].navSecondarys,
        iconDatas: atoms.icon.icons,
        tooltipDatas: atoms.tooltip.tooltips
    }) }}
  {% endif %}

    {# ----- JavaScript scripts (optimized loading) ----- #}
    {# Main bundled script with conditional component loading #}
    <script src="/assets/scripts/main.js" type="module" defer></script>

    {# ----- Netlify Identity redirect (for Decap CMS login) ----- #}
    <script src="/assets/scripts/core/netlify-identity.js"></script>

  </body>
</html>

{#
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
May your bugs be forever exiled to the shadow realm ✦
HAT · 2026
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#}
